# План портирования CastleJs.cs

Файл `CastleJs.cs` является частью `PostFilter` и предназначен для обработки JavaScript-файла `/js/castle.js`.

## Функциональность в C#

Фильтр выполняет одно простое действие: он берет содержимое файла-ресурса `json2.js` и добавляет его в самое начало скачиваемого скрипта `castle.js`.

**Назначение:**

Библиотека `json2.js` (созданная Дугласом Крокфордом) является полифилом, который добавляет поддержку `JSON.parse()` и `JSON.stringify()` в старые браузеры, где они отсутствуют (в частности, Internet Explorer в режиме совместимости, который использовался в C#-клиенте).

Это было необходимо, так как скрипт `castle.js` использует функции для работы с JSON.

## Решение для портирования в Android

Современный компонент `WebView` в Android основан на Chromium и **полностью поддерживает** нативный объект `JSON`. Добавление сторонней библиотеки `json2.js` не только не нужно, но и может привести к конфликтам со встроенной реализацией.

**Вывод: портировать логику этого фильтра не нужно.**

## План действий

Чтобы отметить этот фильтр как обработанный и закрыть этот пункт, необходимо создать "заглушку".

1.  **Создать `CastleJs.java`**: В пакете `ru.neverlands.abclient.postfilter`.
2.  **Реализовать метод `process`**:
    *   Метод будет принимать `byte[] array`.
    *   Он будет **просто возвращать `array` без каких-либо изменений**.
    *   В комментарии к методу будет указано, что добавление `json2.js` в Android не требуется.
3.  **Интегрировать в `Filter.java`**: Добавить вызов `CastleJs.process(array)` в соответствующий блок, чтобы в будущем к этому файлу не возвращаться.
