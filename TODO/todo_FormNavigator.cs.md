# План портирования FormNavigator.cs

Файл `FormNavigator.cs` реализует один из самых сложных и функциональных UI-компонентов — окно "Навигатор".

## Функциональность в C#

Это полноценный инструмент для поиска локаций и построения маршрутов.

1.  **Агрегация данных**: При запуске форма сканирует всю карту (`Map.Cells`) и группирует клетки по множеству критериев: города, замки, форты, наличие определенных ботов, трав, рыбы, шахт и т.д.
2.  **Древовидный список**: Результаты группировки отображаются в виде иерархического дерева (`TreeView`), что позволяет пользователю легко находить нужный тип локации.
3.  **Построение маршрута**: При выборе цели (из дерева или ручным вводом координат), форма создает экземпляр `MapPath`, который вычисляет кратчайший путь от текущего положения игрока.
4.  **Отображение информации**: Рассчитанная информация о маршруте (количество шагов, максимальный уровень ботов на пути, итоговая усталость) выводится в текстовых метках.
5.  **Визуализация маршрута**: Встроенный `WebBrowser` используется для отображения мини-карты, на которой отрисовывается построенный маршрут.
6.  **Запуск авто-навигации**: При нажатии кнопки "В путь!" устанавливаются глобальные флаги, которые служат командой для `MainPhp.cs` начать автоматическое движение по карте.

## Зависимости

*   **`ExtMap`**: Модуль **полностью и критически зависит** от всей системы `ExtMap` (`Map`, `MapPath`, `Cell`). Без портированного `ExtMap` эта форма абсолютно бесполезна.
*   **`MainPhp.cs`**: Интегрируется с основной логикой авто-перемещения.

## План портирования на Android

**Статус: БЛОКИРОВАНО.** Портировать только после полной реализации `ExtMap`.

1.  **UI (`NavigatorActivity.java`)**:
    *   Создать новую `Activity` с двухпанельным интерфейсом (например, на `ConstraintLayout` или `LinearLayout` с весами).
    *   **Левая панель**: `RecyclerView` для отображения дерева локаций. Для реализации древовидной структуры можно использовать кастомный `RecyclerView.Adapter`, который будет управлять вложенностью и состоянием (свернут/развернут) узлов, или найти готовую стороннюю библиотеку.
    *   **Правая панель**: Будет содержать `EditText` для ручного ввода, `WebView` для карты и несколько `TextView` для информации о маршруте.
    *   Внизу экрана — `MaterialButton` "В путь!".

2.  **ViewModel (`NavigatorViewModel.java`)**:
    *   `ViewModel` будет отвечать за всю логику.
    *   При создании он должен будет запросить у портированного `Map.java` данные и подготовить иерархическую структуру для дерева.
    *   Будет содержать `LiveData` для хранения информации о построенном маршруте.
    *   Метод `calculatePath(destination)` будет вызывать `new MapPath(...)` и обновлять `LiveData`.

3.  **Отображение карты**: Логика `UpdateMap` должна быть переписана. Вместо генерации полного HTML, нужно будет загрузить в `WebView` базовую страницу с картой, а затем вызывать на ней JavaScript-функции из Java для отрисовки маршрута (`webView.evaluateJavascript(...)`).

4.  **Запуск навигации**: Кнопка "В путь!" должна будет закрывать `NavigatorActivity` и возвращать в `MainActivity` результат (`Activity.RESULT_OK`) с `Intent`, содержащим целевые координаты. `MainActivity` при получении такого результата должна будет запустить сервис или менеджер, отвечающий за авто-перемещение.
