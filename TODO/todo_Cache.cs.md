# План портирования Cache.cs

Файл `Cache.cs` реализует собственную двухуровневую систему кэширования для ответов на сетевые запросы.

## Функциональность в C#

1.  **Два уровня кэша**:
    *   **Кэш в памяти**: `SortedDictionary`, хранящий последние полученные ответы для максимально быстрого доступа.
    *   **Кэш на диске**: Файловый кэш в папке `abcache`. Ответы на запросы сохраняются на диск в виде файлов, повторяя структуру URL.
2.  **Логика**: При запросе ресурса сначала проверяется кэш в памяти, затем кэш на диске. Если ресурс не найден, происходит реальный сетевой запрос. Полученный ответ затем сохраняется в кэше.
3.  **Исключения**: Скрипты (`.js`) намеренно не кэшируются на диске, только в памяти, чтобы при перезапуске клиента всегда загружались свежие версии.

## Решение для портирования на Android

**Портировать этот класс не нужно.**

Компонент `WebView` в Android имеет собственную мощную и гибкую систему кэширования, которая управляется через класс `WebSettings`. Повторная реализация этой логики вручную приведет к избыточному коду, двойному расходу памяти/диска и потенциальным ошибкам. Правильный подход — использовать встроенные возможности платформы.

## План реализации (вместо портирования)

Необходимо настроить `WebView` для использования встроенного кэша. Это делается при инициализации `WebView`.

1.  **Настройка `WebSettings`**:
    В коде, где создается и настраивается ваш `WebView`, нужно добавить следующие параметры:

    ```java
    WebView myWebView = findViewById(R.id.my_webview);
    WebSettings webSettings = myWebView.getSettings();

    // Включаем кэширование DOM Storage API
    webSettings.setDomStorageEnabled(true);

    // Указываем путь для кэша приложений (для AppCache API, хотя он и устаревает)
    File cacheDir = new File(context.getCacheDir(), "abclient_webview_cache");
    webSettings.setAppCachePath(cacheDir.getAbsolutePath());
    webSettings.setAppCacheEnabled(true);

    // Устанавливаем режим кэширования
    // LOAD_DEFAULT - стандартное поведение.
    // LOAD_CACHE_ELSE_NETWORK - сначала брать из кэша, если нет - идти в сеть.
    // LOAD_NO_CACHE - не использовать кэш.
    // LOAD_CACHE_ONLY - брать только из кэша.
    webSettings.setCacheMode(WebSettings.LOAD_DEFAULT);
    ```

2.  **Очистка кэша**:
    Функциональность `Cache.Clear()` должна быть заменена на вызов нативных методов `WebView`:

    ```java
    // Метод для очистки кэша
    public void clearWebViewCache(WebView webView) {
        // Очищает кэш ресурсов (картинки, css)
        webView.clearCache(true);
    }
    ```

Таким образом, мы делегируем всю работу по кэшированию Android-системе, что является правильным и эффективным подходом.
