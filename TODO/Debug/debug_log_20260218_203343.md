# Журнал отладки - 18.02.2026 20:33

## Проблема 1: Быстрые действия не переключают категории инвентаря
Несмотря на реализованный редирект, переход во вкладку "Свитки" или "Зелья" не происходил корректно. Логи показали, что ссылки на категории не обнаруживались методом `findTargetLink`.

## Проблема 2: Группировка инвентаря (исчезновение предметов)
Пользователь сообщил, что предметы перестали отображаться в категориях после включения группировки. Вероятная причина — слишком строгие селекторы Jsoup и неверная обработка вложенности таблиц в `MainPhp.java` и `InvEntry.java`.

## Предпринятые действия

1.  **Исправление `MainPhp.java` (Инвентарь)**:
    - Селектор контейнера изменен на более гибкий: `td[background*='i_bg_2.gif']`.
    - Логика поиска таблиц предметов переписана: теперь ищутся все `table`, содержащие `/weapon/` или `/invent/`, и для них находится родительская строка `tr`. Это исключает пропуски из-за разницы в атрибутах `cellpadding`.

2.  **Исправление `InvEntry.java` (Модель предмета)**:
    - Конструктор адаптирован для работы с `Element` строки (`tr`).
    - Улучшено извлечение ячеек картинки и инфо (обработка разной глубины вложенности).
    - Улучшен парсинг долговечности (добавлен поиск по тексту "Долговечность:").
    - Ссылки `pss` и `drop` теперь ищутся не только в `<a>`, но и в `input onclick`, что критично для некоторых разделов игры.

3.  **Исправление `FastActionManager.java` (Навигация)**:
    - Метод `findTargetLink` переписан на использование `findLinkWithPattern`.
    - Поиск ссылок теперь не ограничен `location='`, а ищет паттерны `wca=28` или `go=inv` внутри JS-событий, извлекая ссылку целиком.

## Выводы
Проблемы отображения инвентаря на Android часто связаны с тем, что Jsoup ожидает валидный HTML, в то время как игровой интерфейс использует устаревшие атрибуты без кавычек и сложную вложенность таблиц. Использование частичного поиска по атрибутам (`*=`) и поиск родительских тегов по именам повышает стабильность парсинга.
