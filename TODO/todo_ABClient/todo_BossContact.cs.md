# План портирования BossContact.cs

Файл `BossContact.cs` определяет класс для отслеживания конкретного персонажа и анонсирования, если тот вступает в бой с боссом.

## Функциональность в C#

*   **Назначение**: Мониторить активность указанного персонажа. Если персонаж вступает в бой, система проверяет, является ли его противник одним из известных боссов. Если да, то в чат отправляется оповещение.
*   **Свойства**: `Name` (имя отслеживаемого), `NextCheck` (время следующей проверки), `Flog` (ID последнего обработанного боя).
*   **Основная логика (`Process(UserInfo userInfo)`)**:
    1.  Получает `UserInfo` отслеживаемого персонажа.
    2.  Проверяет, онлайн ли он и изменился ли его лог боя (`flog`).
    3.  Если да, загружает полный лог боя через `NeverApi.GetFlog(flog)`.
    4.  Парсит лог, чтобы получить списки участников (`lives_g1`, `lives_g2`).
    5.  Вызывает `CheckLives`, чтобы проверить наличие ID босса в одном из списков.
*   **Логика оповещения (`CheckLives(...)`)**:
    1.  Ищет в списке участников ID, совпадающий с одним из захардкоженных ID боссов.
    2.  При нахождении, генерирует форматированное HTML-сообщение с информацией о бое, его участниках и ссылкой на лог.
    3.  Воспроизводит звуковое оповещение (`EventSounds.PlayBear()`).
    4.  Отправляет сообщение в основной чат клиента.
    5.  В зависимости от настроек профиля, может отправлять сообщение в общий/клановый чат.

## Проверка на существующую реализацию в Android

- **Результат:** Функциональность не реализована. В Android-проекте нет классов или логики для отслеживания боссов.

## Решение для портирования на Android

Необходимо создать класс `BossContact.java` и портировать всю связанную логику. Это потребует также портирования `NeverApi.GetFlog`, `BossMap`, `ContactsManager` и `EventSounds`.

## План реализации

- [ ] **Создать файл `BossContact.java`** в пакете `ru.neverlands.abclient.model`.
    - [ ] Определить поля: `name`, `nextCheck`, `lastBossUpdated`, `flog`.
    - [ ] Создать конструктор.

- [ ] **Портировать метод `process(UserInfo userInfo)`**:
    - [ ] Потребуется портировать класс `UserInfo`.
    - [ ] Потребуется портировать `NeverApi.getFlog()`. Это будет сетевой запрос, который нужно выполнять в фоновом потоке (например, с помощью `OkHttp` и корутин/`AsyncTask`).
    - [ ] Логику парсинга `lives_g1` и `lives_g2` из ответа `GetFlog` нужно будет переписать с использованием `String.split` или регулярных выражений.

- [ ] **Портировать метод `checkLives(...)`**:
    - [ ] Перенести список захардкоженных ID боссов.
    - [ ] Логику генерации HTML-сообщений перенести с использованием `StringBuilder`.
    - [ ] Потребуется портировать `BossMap.getRegNum()`.
    - [ ] Потребуется портировать `EventSounds.playBear()`.
    - [ ] Логику отправки сообщений в чат нужно будет адаптировать под Android (например, через `LiveData` или `BroadcastReceiver`).

- [ ] **Портировать вспомогательные методы**:
    - [ ] `HtmlBossEntry(String id, String name)`
    - [ ] `HtmlPercEntry(UserInfo userInfo)`

- [ ] **Создать менеджер `BossContactManager`**:
    - [ ] Создать класс, который будет хранить список объектов `BossContact` и периодически вызывать для них метод `process()`.

- [ ] **Обновить `todo_ABClient.md`**, отметив `BossContact.cs` как проанализированный.
