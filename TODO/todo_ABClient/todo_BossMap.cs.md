# План портирования BossMap.cs

Файл `BossMap.cs` представляет собой статический класс-утилиту для работы с картой расположения боссов.

## Функциональность в C#

*   **Назначение**: Сопоставить текстовое название локации (например, "Вход в город") с одним или несколькими "regnum" (регистрационными номерами ячеек карты).
*   **Хранение данных**: Данные хранятся в `List<KeyValuePair<string, string>> Terrain`.
*   **Загрузка данных (`LoadMap()`)**: 
    *   При запуске, метод читает XML-файл `abcells.xml`.
    *   Парсит XML, извлекая из каждого тега `<cell>` атрибуты `label` (название локации) и `regnum` (номер ячейки).
    *   Заполняет этими данными список `Terrain`.
*   **Поиск (`GetRegNum(string location)`)**:
    *   Принимает на вход название локации.
    *   Ищет в списке `Terrain` все записи, у которых ключ совпадает с названием локации.
    *   Возвращает строку, содержащую все найденные `regnum`, разделенные запятой.

## Проверка на существующую реализацию в Android

- **Результат:** Частично реализовано. Файл `abcells.xml` копируется в `assets` при первом запуске приложения (в `DataManager.java`). Однако, отсутствует класс и логика для загрузки, парсинга и использования данных из этого файла.

## Решение для портирования на Android

Необходимо создать синглтон или статический класс `BossMap.java`, который будет загружать и парсить `abcells.xml` из `assets` и предоставлять метод для поиска `regnum`.

## План реализации

- [ ] **Создать файл `BossMap.java`** в пакете `ru.neverlands.abclient.manager`.

- [ ] **Реализовать класс как синглтон**:
    ```java
    public class BossMap {
        private static final BossMap instance = new BossMap();
        private final List<Pair<String, String>> terrain = new ArrayList<>();

        private BossMap() {}

        public static BossMap getInstance() {
            return instance;
        }
        // ... методы
    }
    ```
    *(Вместо `KeyValuePair` можно использовать `android.util.Pair`)*.

- [ ] **Портировать метод `loadMap()`**:
    - [ ] Метод должен вызываться один раз при старте приложения (например, из `ABClientApplication.java`).
    - [ ] Для чтения файла из `assets` использовать `AssetManager`.
    - [ ] Для парсинга XML использовать встроенный в Android `XmlPullParser` или `DocumentBuilder`.
    - [ ] В цикле парсинга извлекать атрибуты `label` и `regnum` и добавлять их в `terrain`.

- [ ] **Портировать метод `getRegNum(String location)`**:
    - [ ] Метод должен итерироваться по списку `terrain`.
    - [ ] Собирать все `regnum` (второй элемент `Pair`), у которых `label` (первый элемент `Pair`) совпадает с искомой локацией.
    - [ ] Использовать `StringBuilder` для формирования итоговой строки.

- [ ] **Обновить `todo_ABClient.md`**, отметив `BossMap.cs` как проанализированный.
