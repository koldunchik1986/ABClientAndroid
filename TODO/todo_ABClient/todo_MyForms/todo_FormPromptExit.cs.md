
### 1. План портирования FormPromptExit.cs

Файл `FormPromptExit.cs` реализует диалоговое окно для подтверждения выхода из приложения, с обратным отсчетом.

### 2. Функциональность в C#

- **UI:** Диалоговое окно с текстом подтверждения, галочкой "Больше не спрашивать" и кнопками Да/Нет.
- **Логика:**
    - При открытии диалога запускается таймер.
    - Каждую секунду таймер обновляет текст на кнопке "Да", показывая, сколько секунд осталось до автоматического выхода (например, "Да (8 сек до выхода)").
    - Когда счетчик доходит до нуля, диалог автоматически закрывается с результатом `OK`, подтверждая выход.
    - Пользователь может нажать "Да" или "Нет" до истечения таймера.
    - Состояние галочки "Больше не спрашивать" считывается через свойство `SkipPromptExit`.

### 3. Решение для портирования на Android

Это стандартный диалог подтверждения, похожий на `FormAutoLogon`. Его следует реализовать с помощью `DialogFragment` и `CountDownTimer`.

### 4. План реализации

### 4. План реализации

Анализ показал, что в `MainActivity.java` уже существует метод `showExitConfirmationDialog`, который показывает простой `AlertDialog`. План состоит в доработке этого существующего диалога.

1.  **Создать кастомную разметку для диалога:**
    - Создать `layout/dialog_prompt_exit.xml`.
    - Разместить в нем `TextView` с вопросом, `CheckBox` "Больше не спрашивать" и оставить место для стандартных кнопок диалога.
2.  **Модифицировать `showExitConfirmationDialog()` в `MainActivity.java`:**
    - Вместо простого `.setMessage()`, использовать `.setView()` для установки кастомной разметки.
    - После `dialog.show()`, получить доступ к `CheckBox` из разметки и к кнопке "Да" (`dialog.getButton(AlertDialog.BUTTON_POSITIVE)`).
3.  **Реализовать `CountDownTimer`:**
    - Создать и запустить `CountDownTimer`.
    - В `onTick` обновлять текст на кнопке "Да".
    - В `onFinish` вызывать `activity.finish()`.
4.  **Обновить обработчики кнопок:**
    - В `OnClickListener` для кнопки "Да":
        - Остановить таймер (`timer.cancel()`).
        - Прочитать состояние `CheckBox` и сохранить его в `SharedPreferences`.
        - Закрыть приложение (`activity.finish()`).
    - В `OnClickListener` для кнопки "Нет":
        - Остановить таймер и закрыть диалог.
5.  **Обновить логику `onBackPressed()`:**
    - Перед вызовом `showExitConfirmationDialog`, проверять `SharedPreferences`. Если там стоит флаг "не спрашивать", то сразу выходить из приложения, не показывая диалог.

- [ ] Создать кастомную XML-разметку `dialog_prompt_exit.xml`.
- [ ] Модифицировать `showExitConfirmationDialog` для использования кастомной разметки.
- [ ] Добавить в метод логику `CountDownTimer`.
- [ ] Реализовать сохранение настройки "Больше не спрашивать" в `SharedPreferences`.
- [ ] Добавить проверку этой настройки в `onBackPressed`.
