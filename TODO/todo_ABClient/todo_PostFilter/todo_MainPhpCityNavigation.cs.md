# План портирования MainPhpCityNavigation.cs

Файл `MainPhpCityNavigation.cs` - это часть `partial` класса `Filter`, отвечающая за логику автоматической навигации внутри городов.

## Функциональность в C#

*   **Назначение**: Автоматизировать перемещение игрока по городским локациям, которые представляют собой карты-изображения с кликабельными областями, а не стандартную сетку карты.
*   **Ключевые методы**:
    *   `MainPhpCityNavigation(string html)`: Основной метод-маршрутизатор. В зависимости от текущего положения и цели, определяет, какую текстовую ссылку (например, "Перейти в жилой квартал") нужно найти на странице.
    *   `MainPhpCityArea(string html, string area)`: Находит на странице ссылку (тег `<a>` или `<area>`), у которой всплывающая подсказка (`tooltip`) совпадает с искомым текстом `area`. Извлекает `HREF` этой ссылки и генерирует HTML-страницу с редиректом на этот `HREF`.
    *   `MainPhpStartFromCityNavigation(string html)`: Метод для инициации выхода из города. Использует большую `SortedDictionary` как таблицу соответствий, чтобы по текущему экрану и целевой ячейке карты определить, на какую ссылку "Выход из города" нужно нажать.

## Проверка на существующую реализацию в Android

- **Результат:** Функциональность не реализована.

## Решение для портирования на Android

Необходимо создать новый класс `MainPhpCityNavigation.java` и портировать в него всю логику. Логика парсинга HTML для поиска ссылок останется схожей, но может быть улучшена с использованием `Jsoup`.

## План реализации

- [ ] **Создать файл `MainPhpCityNavigation.java`** в пакете `ru.neverlands.abclient.postfilter`.

- [ ] **Портировать метод `mainPhpCityArea(String html, String area)`**:
    - [ ] Создать статический метод.
    - [ ] Вместо ручного поиска `IndexOf` использовать библиотеку `Jsoup` для более надежного парсинга: `doc.select("a:has(img[onmouseover*='" + area + "'])")` или `doc.select("area[onmouseover*='" + area + "']")`.
    - [ ] Из найденного элемента извлечь атрибут `href`.
    - [ ] Вызвать `Filter.buildRedirect(...)` для создания редиректа.

- [ ] **Портировать `MainPhpStartFromCityNavigation(String html)` и `MainPhpCityNavigation(String html)`**:
    - [ ] Перенести всю логику определения, какую ссылку нужно искать.
    - [ ] `SortedDictionary` можно заменить на `HashMap` в Java.
    - [ ] Эти методы будут вызывать портированный `mainPhpCityArea`.

- [ ] **Интегрировать в `MainPhp.java`**:
    - [ ] В методе `process` класса `MainPhp.java` нужно будет добавить вызовы этих новых методов в соответствующем месте (в блоке, где обрабатывается `AutoMoving`).

- [ ] **Обновить `todo_PostFilter.md`**, отметив `MainPhpCityNavigation.cs` как проанализированный.
