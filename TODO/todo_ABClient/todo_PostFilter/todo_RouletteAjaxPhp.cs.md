# План портирования RouletteAjaxPhp.cs

Файл `RouletteAjaxPhp.cs` - это часть `partial` класса `Filter`, отвечающая за обработку ответа от игры в рулетку.

## Функциональность в C#

*   **Назначение**: Перехватить AJAX-ответ от рулетки, извлечь из него результат (выигрыш/проигрыш) и отобразить его пользователю.
*   **Логика**: 
    1.  Парсит строку ответа, разделенную символами `@`.
    2.  Если ответ начинается с `OK`, извлекает текстовое сообщение о результате.
    3.  Отправляет это сообщение в игровой чат.
    4.  Инициирует перезагрузку верхнего фрейма (`main.php`), чтобы обновить баланс NV и другие показатели.

## Проверка на существующую реализацию в Android

- **Результат:** Частично реализовано.
- **Объяснение**:
    1.  В проекте существует класс `app/src/main/java/ru/neverlands/abclient/postfilter/RouletteAjaxPhp.java`.
    2.  В нем реализована логика парсинга строки ответа.
    3.  Однако, вся логика взаимодействия с UI (отправка сообщения в чат и перезагрузка фрейма) отсутствует и помечена комментариями `// TODO`.

## Решение для портирования на Android

Необходимо завершить портирование, добавив недостающую логику обратной связи с пользователем.

## План реализации

- [ ] **Открыть `RouletteAjaxPhp.java`**.

- [ ] **Реализовать систему событий**:
    - [ ] Вместо прямого вызова UI, `RouletteAjaxPhp` должен отправлять события. `LocalBroadcastManager` - хороший кандидат.
    - [ ] В блоке, где извлекается сообщение, отправлять `new Intent("ACTION_SEND_CHAT_MESSAGE").putExtra("message", ...)`.
    - [ ] В конце метода отправлять `new Intent("ACTION_RELOAD_MAIN_FRAME")`.

- [ ] **Подписать `MainActivity` на события**:
    - [ ] В `BroadcastReceiver`'е в `MainActivity` добавить обработку этих новых `ACTION`'ов.
    - [ ] При получении `ACTION_SEND_CHAT_MESSAGE` - отобразить сообщение в `WebView` чата.
    - [ ] При получении `ACTION_RELOAD_MAIN_FRAME` - вызвать `webView.loadUrl(...)` для соответствующего фрейма.

- [ ] **Обновить `todo_PostFilter.md`**, отметив `RouletteAjaxPhp.cs` как проанализированный.
