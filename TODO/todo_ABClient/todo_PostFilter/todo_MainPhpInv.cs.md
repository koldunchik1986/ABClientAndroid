### 1. План портирования MainPhpInv.cs

Файл `MainPhpInv.cs` является частью `partial class` `Filter` и отвечает за обработку и модификацию инвентаря игрока, когда он отображается на странице `main.php`.

### 2. Зависимости

- **`InvEntry.cs`:** Это ключевая зависимость. Класс `InvEntry` представляет собой один предмет в инвентаре. Он парсит HTML-блок одного предмета, извлекая всю информацию о нем (название, прочность, ссылки на действия, цены и т.д.), и предоставляет методы для его модификации.

### 3. Функциональность в C#

- **`MainPhpInv(string html)`:**
    1.  **Поиск начала инвентаря:** Находит точку в HTML, где начинается список предметов.
    2.  **Парсинг предметов:** В цикле `while(true)` проходит по HTML, вырезает блок каждого предмета и создает для него объект `InvEntry`.
    3.  **Авто-выброс (Bulk Drop):** Проверяет, не является ли текущий предмет тем, который нужно выбросить (сравнивает `AppVars.BulkDropThing` и `AppVars.BulkDropPrice`). Если да, генерирует HTML-редирект на ссылку выброса (`invEntry.DropLink`) и немедленно завершает работу.
    4.  **Авто-продажа (Bulk Sell):** Аналогично проверяет, не нужно ли продать предмет в лавку, и генерирует редирект.
    5.  **Группировка (Packing):** Если включена опция `AppVars.Profile.DoInvPack`, сравнивает все предметы в списке друг с другом. Если предметы идентичны (по названию, свойствам и т.д.), удаляет дубликат и увеличивает счетчик у первого (`invEntry.Inc()`).
    6.  **Добавление кнопок:** Проходит по списку обработанных `InvEntry` и вызывает у каждого методы `AddBulkSell()` и `AddBulkDelete()`, которые добавляют в HTML предмета кастомные кнопки "Продать все" и "Выбросить все".
    7.  **Сортировка:** Если включена опция `AppVars.Profile.DoInvSort`, сортирует список `InvEntry` с помощью кастомного `InvComparer`.
    8.  **Пересборка HTML:** Собирает HTML-код всех обработанных `InvEntry` в один большой `StringBuilder` и заменяет им оригинальный блок инвентаря в исходном HTML.

- **`InvEntry.cs`:**
    - **Конструктор:** Принимает на вход HTML-блок одного предмета и парсит его с помощью `HelperStrings.SubString` для извлечения десятков полей: `Name`, `Dolg`, `Price`, `WearLink`, `DropLink`, `PssLink` и т.д.
    - **`IsExpired()`:** Проверяет, не истек ли срок годности предмета.
    - **`CompareTo()`:** Сравнивает два предмета на идентичность (для группировки).
    - **`Build()`:** Собирает HTML-представление предмета из его полей, включая счетчик количества (если > 1) и кастомные кнопки.

### 4. Решение для портирования на Android

Необходимо портировать оба класса, `InvEntry` и логику `MainPhpInv`. Для парсинга HTML вместо `HelperStrings` следует использовать `Jsoup` для большей надежности.

- **Архитектура:**
    - **`model/InvEntry.java`:** Будет Java-версией класса `InvEntry`. Конструктор будет принимать `org.jsoup.nodes.Element` (HTML-блок предмета) и парсить его.
    - **`postfilter/MainPhp.java`:** Логика из `MainPhpInv.cs` будет реализована в методе `mainPhpInv(String html)`.

### 5. План реализации

1.  **Создать `InvEntry.java`:**
    - [x] Создать класс `InvEntry` в пакете `ru.neverlands.abclient.model`.
    - [x] Перенести все поля из C#-класса.
    - [x] Реализовать конструктор, принимающий `Element` из `Jsoup`. Внутри конструктора с помощью `element.select(...)` и `element.attr(...)` извлечь все данные о предмете.
    - [x] Портировать методы `isExpired`, `compareTo`, `build` и другие, адаптируя их под Java.
2.  **Реализовать `mainPhpInv` в `MainPhp.java`:**
    - [x] В методе `mainPhpInv` использовать `Jsoup.parse(html)` для получения `Document`.
    - [x] Найти контейнер с инвентарем и с помощью `document.select(...)` получить `Elements` (список всех предметов).
    - [x] В цикле `for (Element itemElement : items)` создавать `new InvEntry(itemElement)`.
    - [x] Портировать всю логику обработки списка `InvEntry`: авто-выброс, авто-продажа, группировка, сортировка.
    - [x] Собрать новый HTML-блок инвентаря.
    - [x] Заменить старый блок в `document` на новый с помощью `container.html(newHtml)`.
    - [x] Вернуть `document.outerHtml()`.
3.  **Проверка логики:**
    - [x] После реализации, внимательно сравнить код `InvEntry.java` и `mainPhpInv` с C#-оригиналами, чтобы убедиться в идентичности логики сравнения, сортировки и генерации ссылок.

- [ ] Создать `InvEntry.java` и реализовать его полный функционал с использованием `Jsoup`.
- [ ] Реализовать метод `mainPhpInv` в `MainPhp.java`, портировав всю логику обработки инвентаря.