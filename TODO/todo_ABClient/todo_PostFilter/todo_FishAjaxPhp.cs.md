### 1. План портирования FishAjaxPhp.cs

Файл `FishAjaxPhp.cs` обрабатывает AJAX-ответ от сервера после попытки рыбалки, реализуя логику для функции "Авто-рыбалка".

### 2. Функциональность в C#

- **Назначение:** Анализировать результат рыбалки, обновлять статистику, уведомлять пользователя и модифицировать ответ сервера для отображения подробного отчета.
- **Триггер:** Ответ от `fish_ajax.php`.
- **Обработка ошибок:** Проверяет ответ на наличие сообщений об ошибках (нет снастей, нет наживки, не хватает умения) и, если находит, отключает авто-рыбалку (`UpdateFishOffDelegate`).
- **Парсинг данных (`FishReport`):**
    - Извлекает из строки ответа имя пойманной рыбы, количество улова, количество потраченной наживки и факт повышения умения.
    - Использует `HelperStrings.SubString` для извлечения данных.
- **Обновление состояния:**
    - Инкрементирует счетчик умения `AppVars.Profile.FishUm`.
    - Рассчитывает прибыль/убыток, используя **жестко закодированные** таблицы цен на рыбу и наживку.
    - Обновляет общую прибыль от рыбалки `AppVars.AutoFishNV`.
    - Обновляет массу инвентаря `AppVars.AutoFishMassa`.
- **Модификация ответа:**
    - **Не возвращает исходный ответ.** Вместо этого, генерирует новый, детализированный HTML-блок, содержащий всю статистику по улову: название рыбы, улов/клев, изменение умения, изменение долговечности удочки, изменение массы инвентаря, доход за текущий заброс и общий доход за сессию рыбалки.
    - Этот новый HTML-блок вставляется в исходную строку ответа от сервера, заменяя оригинальное, менее подробное сообщение.
    - Также формирует текстовую версию отчета для показа во всплывающем уведомлении (tray baloon) и отдельное сообщение для игрового чата.

### 3. Решение для портирования на Android

Логика является сложной и сильно завязана на глобальные переменные `AppVars` и прямое обновление UI. При портировании это следует реорганизовать.

- **Архитектура:**
    - **`FishViewModel`:** Должен управлять состоянием авто-рыбалки (`isFishing`, `totalProfit`, `lastCatch` и т.д.).
    - **`FishRepository`:** Должен инкапсулировать логику парсинга и расчеты. Данные о ценах на рыбу и наживку следует вынести из кода в `Map` или JSON-ресурс внутри репозитория.
- **UI:** Вместо модификации HTML-ответа, следует обновлять нативный UI. Это может быть отдельный фрагмент со статистикой рыбалки или карточка на главном экране. Уведомления должны создаваться через `NotificationManager`.
- **Прямое портирование (для выполнения текущей задачи):** Чтобы максимально точно воспроизвести логику C#-фильтра, как он есть, необходимо портировать и логику модификации HTML-ответа. Это будет временным решением до перехода на нативный UI.

### 4. План реализации

1.  **Создать `FishData.kt`:**
    - [x] Создать `data class` для хранения жестко закодированных цен и масс рыбы и наживки. В идеале, это должно быть в JSON, но для прямого порта можно временно сделать `Map`.
2.  **Реализовать `FishAjaxPhp.java`:**
    - [x] В методе `process` портировать логику из C#.
    - [x] **Парсинг:** Перенести логику из `FishReport` для извлечения `nameFish`, `numFish`, `catchFish`, `fishUmUp`.
    - [x] **Расчеты:** Перенести логику расчета прибыли и массы, используя данные из `FishData`.
    - [x] **Обновление состояния:** Обновлять соответствующие поля в `AppVars` (например, `AppVars.Profile.FishUm`, `AppVars.AutoFishNV`). В будущем это будет заменено на вызовы `ViewModel`.
    - [x] **Генерация HTML:** Создать `StringBuilder` и воссоздать HTML-отчет, который генерирует C#-версия.
    - [x] **Модификация ответа:** Заменить исходное сообщение в ответе на сгенерированный HTML-отчет.
    - [x] **Обратная связь:**
        - Вызывать `Chat.addMessageToChat` для вывода отчета в чат.
        - Вызывать `NotificationManager` для показа уведомления (замена `UpdateTrayBaloon`).
3.  **Добавить недостающие поля в `AppVars.java`:**
    - [x] Проверить и добавить поля, необходимые для отслеживания состояния рыбалки (`AutoFishHand1D`, `NamePri`, `ValPri` и т.д.).

- [x] Создать класс или объект `FishData` с ценами.
- [x] Реализовать полную логику парсинга и расчетов в `FishAjaxPhp.java`.
- [x] Реализовать логику генерации и подмены HTML в ответе.
- [x] Добавить недостающие глобальные переменные в `AppVars` для обеспечения работы.