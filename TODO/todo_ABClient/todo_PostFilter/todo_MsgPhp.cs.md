### 1. План портирования MsgPhp.cs

Файл `MsgPhp.cs` является фильтром для страницы `msg.php`. Эта страница представляет собой фрейм, в котором отображаются сообщения чата.

### 2. Функциональность в C#

- **Назначение:** Реализовать функцию "сохранения чата" при перезагрузках. Стандартно, при каждом обновлении фрейма `msg.php`, его содержимое очищается. Этот фильтр предотвращает это.
- **Логика:**
    1.  Проверяется флаг `AppVars.Profile.ChatKeepGame`.
    2.  Если флаг установлен, фильтр берет содержимое глобальной переменной `AppVars.Chat` (где, предположительно, хранится предыдущая история чата) и вставляет его в начало `<body>` полученной страницы.
    3.  Таким образом, старые сообщения снова появляются в окне чата после его обновления.

### 3. Решение для портирования на Android

Логика очень проста и портируется напрямую. Однако, это подчеркивает сильную зависимость от глобальных переменных `AppVars`, что в будущем следует рефакторить.

- **Архитектура:**
    - Логика будет реализована в методе `process()` класса `postfilter.MsgPhp.java`.
    - Потребуется добавить поле `ChatKeepGame` в `UserConfig.java` и статическое поле `Chat` в `AppVars.java`.
    - Логика, которая *сохраняет* текущие сообщения в `AppVars.Chat`, скорее всего, должна находиться в хуке `chatFilter` (из `ChMsgJs.cs`), который перехватывает все сообщения.

### 4. План реализации

1.  **Добавить поля:**
    - [x] В `UserConfig.java` добавить `public boolean ChatKeepGame;` и инициализировать его в конструкторе (например, `true`).
    - [x] В `AppVars.java` добавить `public static String Chat = "";`.
2.  **Реализовать `MsgPhp.java`:**
    - [x] В методе `process(byte[] array)` преобразовать массив в строку `html`.
    - [x] Добавить проверку `if (AppVars.Profile.ChatKeepGame && AppVars.Chat != null && !AppVars.Chat.isEmpty())`.
    - [x] Внутри `if` выполнить замену: `html = html.replace(" id=msg>", " id=msg>" + AppVars.Chat);`.
    - [x] Вернуть измененный `html` в виде `byte[]`.
3.  **Обновить `todo_PostFilter.md`:**
    - [x] Пометить `MsgPhp.cs` как `[x]` проанализированный.

- [x] Добавить необходимые поля в `UserConfig.java` и `AppVars.java`.
- [x] Реализовать `MsgPhp.java`.