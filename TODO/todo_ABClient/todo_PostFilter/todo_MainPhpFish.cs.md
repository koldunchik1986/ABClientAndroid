
### 1. План портирования MainPhpFish.cs

Файл `MainPhpFish.cs` содержит сложную логику для функции автоматической рыбалки ("автофишинг").

### 2. Функциональность в C#

Функциональность разделена на две основные части: подготовка к рыбалке и анализ отчета.

#### `MainPhpAutoFishPrepare` (Подготовка)

- **Назначение:** Выполняется на странице рыбалки перед забросом удочки.
- **Логика:**
    1.  **Проверка страницы:** Убеждается, что это страница рыбалки.
    2.  **Извлечение параметров:** Парсит из HTML все необходимые параметры для совершения действия (`get_id`, `act`, `vcode`, `lakeid`).
    3.  **Выбор наживки:** Случайным образом выбирает наживку (`primid`) из списка разрешенных в профиле пользователя.
    4.  **Отметка наживки:** Проставляет в HTML `checked` для выбранной наживки.
    5.  **Обработка отсутствия наживки:** Если доступных наживок нет, отключает авторыбалку.
    6.  **Формирование URL:** Собирает URL для следующего действия (заброса удочки), включая `vcode` и ID наживки.
    7.  **Обработка капчи:** Если на странице обнаружена капча, инициирует звуковое и визуальное оповещение для пользователя.

#### `MainPhpFishReport` (Отчет)

- **Назначение:** Выполняется на странице с результатами рыбалки.
- **Логика:**
    1.  **Парсинг отчета:** Извлекает из HTML информацию о том, какая рыба поймана, сколько поймано (`numFish`), а сколько клевало (`catchFish`). Проверяет, повысилось ли умение.
    2.  **Расчет прибыли/убытков:** Рассчитывает финансовый результат от улова, учитывая стоимость наживки и ценность рыбы.
    3.  **Обновление статистики сессии:** Обновляет общую прибыль/убыток за текущую сессию рыбалки (`AppVars.AutoFishNV`).
    4.  **Внедрение подробного отчета:** Вставляет в HTML-страницу подробную таблицу со статистикой: улов, остаток наживки, изменение массы инвентаря, доход за улов и общий доход за сессию.
    5.  **Отправка отчетов в чат:** Может отправлять в игровой чат краткие или подробные отчеты о результатах.
    6.  **Системные уведомления:** Может показывать всплывающее уведомление с деталями улова.

### 3. Решение для портирования на Android

Это очень сложная и зависимая от состояния (`AppVars`) функция. Она требует полной переработки и реализации на стороне Android-приложения.

### 4. План реализации

1.  **Создать класс `AutoFishManager` в Android:**
    - Будет управлять всем циклом авторыбалки: состоянием (ожидание, рыбалка, анализ), настройками, статистикой.
2.  **Интеграция с `WebViewClient`:**
    - `WebViewClient` будет перехватывать страницы, связанные с рыбалкой, и передавать их HTML-код в `AutoFishManager`.
3.  **Реализовать логику в `AutoFishManager`:**
    - **`prepareFishing(html)`:** Реализовать логику выбора наживки и формирования URL для заброса.
    - **`analyzeReport(html)`:** Реализовать логику парсинга отчета, расчета статистики и принятия решения о следующем действии (продолжить рыбалку, остановиться).
4.  **Отображение статистики:**
    - Вместо внедрения HTML-таблицы, создать нативный UI-компонент в Android-приложении, который будет отображать всю статистику рыбалки в реальном времени.
5.  **Обработка капчи:**
    - Реализовать механизм для отображения капчи пользователю и отправки введенного значения.

- [ ] Создать класс `AutoFishManager`.
- [ ] Интегрировать `AutoFishManager` с `WebViewClient`.
- [ ] Реализовать в `AutoFishManager` методы `prepareFishing` и `analyzeReport`.
- [ ] Создать нативный UI для отображения статистики.
- [ ] Реализовать обработку капчи.
