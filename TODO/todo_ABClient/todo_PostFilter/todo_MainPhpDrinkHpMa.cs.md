
### 1. План портирования MainPhpDrinkHpMa.cs

Файл `MainPhpDrinkHpMa.cs` содержит логику для автоматического использования эликсиров восстановления здоровья и маны вне боя.

### 2. Функциональность в C#

- **Назначение:** Автоматически выпить "Эликсир Восстановления", если здоровье или мана опускаются ниже заданного процента.
- **Логика:**
    1.  **Проверка активности:** Проверяет, включена ли опция авто-питья для HP (`LezDoDrinkHp`) или MA (`LezDoDrinkMa`).
    2.  **Парсинг HP/MA:** Извлекает из javascript-переменной `inshp` на странице текущие и максимальные значения здоровья и маны.
    3.  **Проверка порогов:** Рассчитывает проценты HP и MA и сравнивает их с пороговыми значениями, заданными в настройках (`LezDrinkHp`, `LezDrinkMa`).
    4.  **Навигация:**
        *   Если порог достигнут, а инвентарь не открыт, генерирует редирект для перехода в инвентарь.
        *   Если инвентарь открыт, но не на вкладке с эликсирами (`im=6`), генерирует редирект для перехода на эту вкладку.
    5.  **Использование эликсира:**
        *   Находясь на правильной вкладке, ищет в HTML ссылку для использования "Эликсира Восстановления".
        *   Если ссылка найдена, генерирует редирект для ее активации.
    6.  **Защита от зацикливания:** Имеет счетчик (`DrinkDrinkHpMaCount`), который отключает функцию после 5 неудачных попыток, чтобы избежать бесконечных редиректов.
    7.  **Обработка ошибок:** Если эликсир не найден, отключает функцию и сообщает об этом пользователю.

### 3. Решение для портирования на Android

Это сложная логика автоматизации, тесно связанная с состоянием и настройками C# приложения (`AppVars`). Она должна быть полностью переписана на стороне Android-приложения.

### 4. План реализации

1.  **Создать класс `AutoDrinkManager` в Android:**
    - Будет управлять состоянием и настройками авто-питья.
2.  **Реализовать обработку ответа от сервера в `WebViewClient`:**
    - После каждой загрузки страницы передавать HTML-код в `AutoDrinkManager`.
3.  **Реализовать логику в `AutoDrinkManager`:**
    - **Анализ:** Парсить HP/MA, проверять пороги.
    - **Принятие решений:** На основе текущего URL и содержимого страницы, принимать решение о следующем действии (перейти в инвентарь, перейти на вкладку, использовать эликсир).
    - **Выполнение действия:** Генерировать и выполнять следующий URL-запрос через `WebView`.
    - **Управление состоянием:** Реализовать счетчик попыток и обработку ошибок.

- [ ] Создать класс `AutoDrinkManager`.
- [ ] Интегрировать `AutoDrinkManager` с `WebViewClient`.
- [ ] Реализовать в `AutoDrinkManager` логику парсинга, принятия решений и выполнения действий.
- [ ] Реализовать управление состоянием (счетчики, ошибки).
