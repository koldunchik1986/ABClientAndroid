### 1. План портирования TeleportAjax.cs

Файл `TeleportAjax.cs` является частью `partial class` `Filter`. Он обрабатывает ответ от `teleport_ajax.php`, который приходит, когда игрок находится в локации с телепортом.

### 2. Зависимости

Этот фильтр критически зависит от системы навигации, в частности от классов:
- **`ExtMap.Map.cs`:** Статический класс, содержащий всю информацию о карте мира: локации, регионы, их связи и координаты.
- **`ExtMap.MapPath.cs`:** Класс, отвечающий за построение маршрута из точки А в точку Б. Он использует данные из `Map.cs` для расчета кратчайшего пути.

Без портирования этих классов `TeleportAjax.cs` неработоспособен.

### 3. Функциональность в C#

- **Назначение:** Автоматизировать следующий шаг в заранее проложенном маршруте, если текущий шаг — это телепортация.
- **Логика:**
    1.  **Проверка маршрута:** Убеждается, что существует активный маршрут (`AppVars.AutoMovingMapPath`). Если нет, строит новый до цели `AppVars.AutoMovingDestinaton`.
    2.  **Обновление состояния навигации:** Получает из объекта `MapPath` следующий прыжок (`NextJump`) и оставшееся количество прыжков (`Jumps`).
    3.  **Парсинг телепортов:** Парсит из HTML JavaScript-массив `var telep = [[...]];`. Этот массив содержит все доступные точки для телепортации (координаты, цена, vcode).
    4.  **Поиск нужного телепорта:** Итерирует по доступным телепортам. Для каждого пункта назначения он преобразует его координаты `x, y` в `regnum` (уникальный идентификатор региона) с помощью `Map.Location`.
    5.  **Сравнение с маршрутом:** Сравнивает `regnum` каждого телепорта с `AppVars.AutoMovingNextJump`.
    6.  **Генерация редиректа:** Если совпадение найдено, генерирует HTML-страницу с редиректом на URL телепортации, используя `vcode` и другие параметры из распарсенного массива.
    7.  **Выход из телепорта:** Если ни один из доступных телепортов не совпадает со следующим шагом маршрута, это означает, что нужно выйти из комнаты телепорта пешком. Фильтр находит `vcode` для выхода (`go=up`) и генерирует редирект на выход.

### 4. Решение для портирования на Android

Портирование этого фильтра требует предварительного портирования всей системы `ExtMap`.

- **Архитектура:**
    - **`repository/MapRepository.kt`:** Должен будет загружать данные о карте (из JSON-файлов, портированных из `Map.cs`) и предоставлять методы для работы с ними.
    - **`utils/MapPath.java`:** Портированная версия класса `MapPath` с алгоритмом поиска пути.
    - **`postfilter/TeleportAjax.java`:** После портирования зависимостей, этот класс будет реализован с той же логикой, что и в C#. Парсинг JS-массива можно будет выполнить с помощью `String.split()`.

### 5. План реализации

1.  **[БЛОКЕР] Портировать `ExtMap`:**
    - [ ] Проанализировать и портировать `Map.cs`, вероятно, путем конвертации его данных в JSON и создания `MapRepository`.
    - [ ] Проанализировать и портировать `MapPath.cs`.
2.  **Реализовать `TeleportAjax.java`:**
    - [ ] После портирования `ExtMap`, реализовать логику, описанную выше.
3.  **Обновить `todo_PostFilter.md`:**
    - [ ] Пометить `TeleportAjax.cs` как `[x]` проанализированный.

- [ ] Создать анализ для `Map.cs` и `MapPath.cs`.
- [ ] Уведомить пользователя о необходимости портирования `ExtMap` перед `TeleportAjax`.