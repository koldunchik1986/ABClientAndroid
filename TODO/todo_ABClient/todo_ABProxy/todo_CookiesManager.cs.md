
### 1. План портирования CookiesManager.cs

Файл `CookiesManager.cs` реализует простое хранилище cookie, сгруппированных по хостам.

### 2. Функциональность в C#

- **Назначение:** Хранить и предоставлять cookie для HTTP-запросов, перехваченных прокси.
- **Логика:**
    - **`CookiePackCollection`**: Основное хранилище, `SortedDictionary`, где ключ - это хост, а значение - `CookiePack` (коллекция cookie для этого хоста).
    - **`Assign(host, data)`**: Парсит строку из заголовка `Set-Cookie` и добавляет cookie в коллекцию для соответствующего хоста. Содержит специальную логику для `www.neverlands.ru` для проверки `NeverNick` при логине.
    - **`Obtain(host)`**: Получает строку cookie для заголовка `Cookie` для указанного хоста. Содержит специальную логику для совместного использования cookie между `www.neverlands.ru` и `forum.neverlands.ru`.
    - **`ClearGame()`**: Очищает все сохраненные cookie.
    - **Потокобезопасность:** Использует `ReaderWriterLock` для доступа к коллекции.

### 3. Решение для портирования на Android

В Android есть встроенные, мощные и проверенные механизмы для управления cookie. Переписывать эту логику с нуля нецелесообразно и небезопасно.

- **`android.webkit.CookieManager`**: Синглтон для управления cookie, используемыми `WebView`.
- **`java.net.CookieManager`** и **`java.net.CookieStore`**: Стандартные Java-классы для управления cookie для HTTP-клиентов (таких как `OkHttp`).

Если прокси-логика будет реализована через `WebViewClient.shouldInterceptRequest`, то `WebView` будет автоматически управлять cookie. Если будет использоваться отдельный HTTP-клиент (например, `OkHttp`), то ему нужно предоставить `CookieJar` (реализацию `java.net.CookieManager`).

### 4. План реализации

1.  **Не портировать класс:** Класс `CookiesManager` не следует портировать.
2.  **Использовать встроенный `CookieManager`:**
    - При настройке `WebView` убедиться, что управление cookie включено.
    - `WebView` будет автоматически обрабатывать заголовки `Set-Cookie` и добавлять заголовок `Cookie` к исходящим запросам.
3.  **Реализовать логику проверки `NeverNick`:**
    - Логику проверки `NeverNick` при логине следует вынести в отдельный компонент, который будет анализировать ответы от сервера после попытки входа.
4.  **Общие cookie для доменов:**
    - `CookieManager` в Android по умолчанию правильно обрабатывает `Domain` атрибут cookie, поэтому специальная логика для `forum.neverlands.ru` скорее всего не понадобится, если сервер отдает правильные заголовки `Set-Cookie`.

- [ ] Удалить `CookiesManager` из плана портирования.
- [ ] Положиться на встроенный в `WebView` механизм управления cookie.
- [ ] Создать отдельный класс/метод для проверки `NeverNick` после логина.
