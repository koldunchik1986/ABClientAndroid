
### 1. План портирования ServerChatter.cs

Файл `ServerChatter.cs` является парным к `ClientChatter.cs` и отвечает за взаимодействие с удаленным сервером: установку соединения, отправку запроса и чтение/парсер ответа.

### 2. Функциональность в C#

- **Назначение:** Управлять исходящим соединением к целевому веб-серверу.
- **Логика:**
    - **`ConnectToHost()`**: Устанавливает TCP-соединение с сервером. Использует `DNSResolver` для получения IP-адреса. Поддерживает работу через вышестоящий (upstream) прокси.
    - **`ResendRequest()`**: Отправляет на сервер HTTP-запрос, полученный от клиента. Сериализует объект `HttpRequestHeaders` и тело запроса в байты и отправляет их в сокет.
    - **`ReadResponse()`**: В цикле читает ответ от сервера в `MemoryStream`.
    - **`IsResponseComplete()`**: Аналогично `ClientChatter`, определяет, когда получен полный ответ, анализируя заголовки `Content-Length` или `Transfer-Encoding`.
    - **`ParseResponseForHeaders()`**: Вручную парсит заголовки ответа.
    - **`LeakResponseBytes()`**: Оптимизация, позволяющая отправлять данные клиенту по мере их поступления от сервера, не дожидаясь полного ответа (стриминг).

### 3. Решение для портирования на Android

Всю эту низкоуровневую логику следует заменить использованием современного HTTP-клиента, такого как `OkHttp`.

При подходе с `WebViewClient.shouldInterceptRequest`, `OkHttp` возьмет на себя всю работу `ServerChatter`:
- Управление соединениями и сокетами.
- DNS-резолвинг и кэширование.
- Формирование и отправку HTTP-запроса.
- Прием и парсинг HTTP-ответа.

### 4. План реализации

1.  **Не портировать класс:** Класс `ServerChatter` не следует портировать.
2.  **Использовать HTTP-клиент:**
    - В методе `shouldInterceptRequest` после получения `WebResourceRequest` от `WebView`:
    - Создать объект `okhttp3.Request`, скопировав в него URL, метод, заголовки и тело из `WebResourceRequest`.
    - Выполнить запрос с помощью `OkHttpClient.newCall(request).execute()`.
    - Получить готовый объект `okhttp3.Response`.
    - Вся функциональность `ServerChatter` заменяется этими несколькими строками кода.

- [ ] Удалить `ServerChatter` из плана портирования.
- [ ] Использовать `OkHttp` (или аналогичный клиент) для выполнения исходящих запросов внутри `shouldInterceptRequest`.
