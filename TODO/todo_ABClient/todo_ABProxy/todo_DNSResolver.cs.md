
### 1. План портирования DNSResolver.cs

Файл `DNSResolver.cs` реализует простой DNS-резолвер с кэшированием для ускорения разрешения имен хостов.

### 2. Функциональность в C#

- **Назначение:** Преобразовывать имя хоста в IP-адрес, кэшируя результаты для уменьшения задержек.
- **Логика:**
    - **`DictAddresses`**: `Dictionary` используется как кэш, где ключ - имя хоста, а значение - `DNSCacheEntry`.
    - **`GetIPAddress(remoteHost, checkCache)`**: Основной метод.
        1.  Пытается распарсить `remoteHost` как IP-адрес. Если удачно, возвращает его.
        2.  Если `checkCache` включен, ищет хост в кэше.
        3.  Если в кэше есть свежая (не старше 60 секунд) запись, использует ее.
        4.  Если записи нет или она устарела, выполняет реальный DNS-запрос через `Dns.GetHostEntry()`.
        5.  Сохраняет новый результат в кэш.
        6.  Возвращает первый IPv4-адрес из списка полученных.
    - **Потокобезопасность:** Использует `ReaderWriterLock` для доступа к кэшу.

### 3. Решение для портирования на Android

Хотя операционная система Android имеет свой собственный DNS-кэш, для высокопроизводительного прокси может быть полезно иметь дополнительный кэш на уровне приложения, чтобы избежать системных вызовов.

Логику можно воспроизвести, используя `java.util.concurrent.ConcurrentHashMap` для потокобезопасного кэширования и `java.net.InetAddress.getAllByName()` для выполнения DNS-запросов.

### 4. План реализации

1.  **Создать класс `DNSResolver`:**
    - Использовать `ConcurrentHashMap<String, DNSCacheEntry>` для кэша.
2.  **Реализовать `getIPAddress(host)`:**
    - Метод будет синхронизирован для потокобезопасности.
    - Проверить, не является ли `host` уже IP-адресом.
    - Проверить наличие свежей записи в кэше.
    - Если нужно, выполнить DNS-запрос через `InetAddress.getAllByName(host)`.
    - Сохранить результат в кэш.
    - Вернуть первый найденный IPv4-адрес.

- [ ] Создать класс `DNSResolver`.
- [ ] Использовать `ConcurrentHashMap` для кэша.
- [ ] Реализовать метод `getIPAddress(host)` с логикой кэширования и выполнения DNS-запросов.
