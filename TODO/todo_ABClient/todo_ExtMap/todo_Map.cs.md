### 1. План портирования Map.cs

Файл `Map.cs` — это огромный статический класс, который является базой данных всей игровой карты. Он загружает и хранит в памяти всю информацию о локациях, их свойствах, связях и пользовательских метках. Этот класс является критической зависимостью для навигации и телепортации.

### 2. Функциональность в C#

- **Хранилище данных:** Класс содержит несколько статических словарей (`SortedDictionary`):
    - `Location`: Сопоставляет координаты (`X/Y_Y`) с `RegNum` (например, `1-001`).
    - `InvLocation`: Обратное сопоставление `RegNum` в координаты.
    - `Cells`: Сопоставляет `RegNum` с объектом `Cell`, который содержит всю информацию о клетке (стоимость прохода, наличие рыбы, травы, ботов и т.д.).
    - `AbcCells`: Сопоставляет `RegNum` с объектом `AbcCell`, который хранит пользовательские данные (заметки, время посещения).
- **Загрузка данных:** В статическом конструкторе класс выполняет следующие действия:
    - `LoadMap()`: Загружает `map.xml`, парсит его и заполняет словари `Cells` и `Location`.
    - `LoadAbcMap()`: Загружает `abcells.xml` (пользовательский файл) и заполняет `AbcCells`.
    - `LoadTeleports()`: Загружает `abteleports.xml`.
- **Вспомогательные методы:** Предоставляет множество статических методов для работы с картой, таких как `ConvertToRegNum`, `Move`, `MakePosition`.
- **Сохранение данных:** Метод `SaveAbcMap()` сохраняет измененные пользовательские данные обратно в `abcells.xml`.

### 3. Решение для портирования на Android

Статический класс с загрузкой XML-файлов — устаревшая архитектура. Необходимо перейти на современный подход с использованием `Repository` и более подходящих форматов данных.

- **Архитектура:**
    - **`repository/MapRepository.kt`:** Будет синглтоном, реализующим паттерн "Репозиторий". Он будет отвечать за загрузку и предоставление всех данных о карте.
    - **Формат данных:**
        - Статические данные из `map.xml` и `abteleports.xml` должны быть **конвертированы в JSON** (`map_data.json`, `teleports.json`) и помещены в `assets`.
        - Пользовательские данные из `abcells.xml` должны храниться в локальной базе данных **Room**. Для этого будет создана сущность `AbcCellEntity`.
    - **Загрузка:** При первом запуске `MapRepository` загрузит JSON из `assets` в `HashMap` в памяти и получит данные из Room.
    - **API:** Репозиторий предоставит публичные `suspend`-функции для доступа к данным (например, `getCell(regnum)`, `getTeleports()`), скрывая детали реализации (откуда берутся данные — из памяти, сети или БД).

### 4. План реализации

1.  **[ПРЕДВАРИТЕЛЬНЫЙ ШАГ] Конвертация XML в JSON:**
    - [ ] Написать небольшой скрипт или программу для конвертации `map.xml` и `abteleports.xml` в соответствующие JSON-файлы.
    - [ ] Поместить полученные JSON-файлы в `app/src/main/assets/`.
2.  **Создать классы-модели:**
    - [ ] `model/Position.java`
    - [ ] `model/Cell.java`
    - [ ] `model/AbcCell.java` (который также будет `@Entity` для Room).
3.  **Создать `MapRepository.kt`:**
    - [ ] Реализовать синглтон.
    - [ ] В методе `init()` реализовать логику загрузки JSON из `assets` с помощью `Gson` и получения данных из `AbcCellDao`.
    - [ ] Реализовать публичные методы для доступа к данным карты.
    - [ ] Реализовать метод для сохранения `AbcCell` в базу данных.

- [ ] Создать анализ для `MapPath.cs`.
- [ ] Создать классы-заглушки для `Position`, `Cell`, `AbcCell` и `MapRepository`.