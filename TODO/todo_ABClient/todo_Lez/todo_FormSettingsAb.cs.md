
### 1. План портирования FormSettingsAb.cs

Файл `FormSettingsAb.cs` представляет собой сложную форму настроек для функции "Автобой" (АБ). Он управляет как общими настройками, так и детализированными правилами для различных групп ботов.

### 2. Функциональность в C#

- **UI:** Форма с вкладками (`TabControl`), содержащая множество элементов управления: `CheckBox`, `RadioButton`, `LinkLabel`, `ListBox` и `ListView`.
- **Данные:** Настройки загружаются из `AppVars.Profile` и сохраняются обратно. Используется глубокое копирование (`DeepClone`) для возможности отмены изменений.
- **Логика:**
    - **Общие настройки:** Включение/выключение АБ, ожидание восстановления HP/маны, использование эликсиров.
    - **Группы ботов:** Создание и управление группами ботов (`LezBotsGroup`), каждая со своими правилами.
    - **Ротация:** Настройка использования ударов, блоков и заклинаний в бою.
    - **Условия остановки:** Правила, по которым бой должен быть прекращен.

### 3. Решение для портирования на Android

Такой экран в Android лучше всего реализовать с помощью `PreferenceFragmentCompat` или набора фрагментов, управляемых `ViewPager2`.

- **Архитектура:**
    - Создать `SettingsAbActivity`, которая будет хостом для фрагментов.
    - Из-за сложности и наличия вкладок, лучше использовать `Fragment`, содержащий `ViewPager2` и `TabLayout`.
    - Каждая вкладка C# (`Общие`, `Группы`, `Ротация` и т.д.) станет отдельным `Fragment` внутри `ViewPager2`.
- **Хранение данных:**
    - Все настройки должны сохраняться в `SharedPreferences`.
    - Сложные объекты, такие как список групп (`List<LezBotsGroup>`), следует сериализовать в JSON (с помощью `Gson` или `Moshi`) и хранить как одну строку в `SharedPreferences`.

### 4. План реализации

1.  **Создать `SettingsAbActivity`:**
    - Пустая `Activity`, которая будет содержать `ViewPager2` и `TabLayout`.
2.  **Создать `SettingsAbViewModel`:**
    - `ViewModel` будет загружать все настройки автобоя из `SharedPreferences` в `LiveData` при инициализации.
    - Он будет предоставлять методы для обновления настроек и их сохранения.
3.  **Создать `SettingsAbGeneralFragment` (Общие настройки):**
    - Использовать компоненты из `androidx.preference`:
        - `SwitchPreferenceCompat` для `checkDoAutoboi`.
        - `Preference` со стилем `LinkLabel`, который открывает `EditTextPreference` (или кастомный диалог) для установки процентов HP/маны.
        - `ListPreference` для настройки сообщений в чате (`LezSayType`).
4.  **Создать `SettingsAbGroupsFragment` (Настройки групп):**
    - Использовать `RecyclerView` для отображения списка групп ботов.
    - Реализовать добавление/удаление групп.
    - При нажатии на группу открывать новый фрагмент (`SettingsAbGroupDetailFragment`) для редактирования правил этой группы.
5.  **Создать `SettingsAbGroupDetailFragment` (Детализация группы):**
    - Этот фрагмент будет содержать `ViewPager2` с вкладками для "Ротации", "Абилок" и "Останова боя".
    - **Ротация:** `SwitchPreferenceCompat` и кастомные `Preference` для настройки процентов.
    - **Абилки:** `MultiSelectListPreference` или `RecyclerView` с `CheckBox` для выбора заклинаний.
    - **Останов боя:** `SwitchPreferenceCompat` и кастомные `Preference`.
6.  **Сериализация:**
    - Реализовать сохранение и загрузку списка `LezBotsGroup` в/из JSON.

- [ ] Создать `SettingsAbActivity` с `ViewPager2`.
- [ ] Создать `SettingsAbViewModel` для управления настройками.
- [ ] Создать `SettingsAbGeneralFragment` для общих настроек.
- [ ] Создать `SettingsAbGroupsFragment` для управления группами.
- [ ] Создать `SettingsAbGroupDetailFragment` для редактирования правил группы.
- [ ] Реализовать сохранение сложных настроек в JSON.
