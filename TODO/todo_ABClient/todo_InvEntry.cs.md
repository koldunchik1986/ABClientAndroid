# План портирования InvEntry.cs

Файл `InvEntry.cs` определяет очень сложный класс для представления и обработки одного предмета (или стопки предметов) в инвентаре.

## Функциональность в C#

*   **Назначение**: Выполняет детальный парсинг HTML-кода, соответствующего одному слоту инвентаря, для извлечения всех возможных данных о предмете. Также предоставляет методы для модификации этого HTML для добавления нового функционала (массовая продажа/удаление).
*   **Парсинг (в конструкторе)**: Принимает фрагмент HTML и с помощью множества вызовов `IndexOf`, `Substring`, `Split` извлекает десятки полей: название, уровень, долговечность, срок годности, ссылки на действия (надеть, продать, выбросить), свойства и т.д.
*   **Модификация HTML**:
    *   `Build()`: Восстанавливает HTML предмета, добавляя к нему информацию о количестве в стопке или о том, что предмет просрочен.
    *   `AddBulkSell()` / `AddBulkDelete()`: Внедряют в HTML новые кнопки, которые через `window.external` вызывают нативный C#-код для выполнения массовых действий.
*   **Сортировка и сравнение**: Реализует `IComparable` со сложной логикой для сортировки инвентаря по множеству критериев (имя, уровень, срок годности и т.д.).

## Проверка на существующую реализацию в Android

- **Результат:** Функциональность не реализована. В Android-проекте нет класса `InvEntry` или подобной логики для парсинга инвентаря.

## Решение для портирования на Android

Это одна из ключевых частей клиента. Портирование потребует создания класса-модели `InvEntry.java` и, что самое сложное, аккуратного переноса всей логики парсинга. Вместо ручного парсинга строк, где это возможно, стоит рассмотреть использование библиотеки для парсинга HTML, такой как `Jsoup`, что сделает код более читаемым и надежным.

## План реализации

- [ ] **Создать файл `InvEntry.java`** в пакете `ru.neverlands.abclient.model`.
    - [ ] Перенести все поля из C#-класса, адаптировав типы.

- [ ] **Портировать конструктор (`InvEntry(String html)`)**:
    - [ ] **Вариант 1 (Прямой перенос)**: Аккуратно перенести всю логику парсинга с `String.indexOf`, `String.substring` и т.д. Это будет трудоемко и подвержено ошибкам.
    - [ ] **Вариант 2 (Рефакторинг с Jsoup)**: 
        - Добавить библиотеку `org.jsoup:jsoup` в `build.gradle`.
        - Использовать `Jsoup.parse(html)` для получения `Document`.
        - Использовать CSS-селекторы (`doc.select(...)`) для извлечения данных. Например, `doc.select("font.nickname b").text()` для получения имени или `doc.select("input[value=Надеть]").attr("onclick")` для получения ссылки. Этот подход гораздо более надежен к изменениям в верстке.

- [ ] **Портировать методы модификации HTML**:
    - [ ] `build()`: Реализовать логику добавления текста к имени и изменения цвета фона.
    - [ ] `addBulkSell()` / `addBulkDelete()`: Реализовать логику добавления новых кнопок. Вместо `window.external` нужно будет использовать JavaScript-интерфейс (`@JavascriptInterface`) для вызова Java-методов из `WebView`.

- [ ] **Реализовать интерфейс `Comparable<InvEntry>`**:
    - [ ] Перенести сложную логику сравнения из метода `CompareTo`.

- [ ] **Создать `InvComparer.java`** как отдельный `Comparator<InvEntry>`.

- [ ] **Обновить `todo_ABClient.md`**, отметив `InvEntry.cs` как проанализированный.
