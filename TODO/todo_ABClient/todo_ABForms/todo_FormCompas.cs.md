
### 1. План портирования FormCompas.cs

Файл `FormCompas.cs` реализует функцию "Компас" — поиск всех членов клана на карте и расчет пути до них.

### 2. Функциональность в C#

- **Назначение:** Найти всех соклановцев онлайн и показать их местоположение и расстояние до них.
- **UI:** Аналогично `FormAddClan`, использует `WebBrowser` для HTML-отчета и `Label` для статуса.
- **Логика:**
    1.  Операция выполняется в фоновом потоке (`ThreadPool`).
    2.  **Скрейпинг:** Получает список всех членов клана, скрейпя сайт `allnl.ru` (та же логика, что и в `FormAddClan`).
    3.  **Анализ:** Для каждого члена клана получает его информацию через `NeverApi`.
    4.  **Поиск пути:** Если игрок онлайн и находится на основной карте, код:
        - Находит все возможные ячейки карты, соответствующие его локации.
        - Использует класс `MapPath` (реализация алгоритма A*) для поиска кратчайшего пути от текущего положения игрока до ближайшей из возможных ячеек.
    5.  **Обновление UI:** Через `BeginInvoke` обновляет статус и добавляет в HTML-отчет строку с информацией о найденном игроке, его местоположении и рассчитанном расстоянии в шагах.

### 3. Решение для портирования на Android

Стратегия портирования почти идентична `FormAddClan`, но с добавлением важного компонента — портирования алгоритма поиска пути A*.

- **UI:** `Activity` или `DialogFragment` с `RecyclerView` для отображения списка найденных игроков и их дистанции.
- **Фоновая задача:** `ViewModel` с корутинами для управления всем процессом.
- **Сеть и парсинг:** `OkHttp` для сетевых запросов и `Jsoup` для парсинга HTML.
- **Поиск пути:** Алгоритм A* из `MapPath.cs` должен быть портирован на Kotlin и использовать данные о карте из базы данных Room.

### 4. План реализации

1.  **Портировать `MapPath.cs`:**
    - Создать класс `MapPathfinder.kt`, содержащий портированную логику алгоритма A*.
2.  **Создать `CompasViewModel.kt`:**
    - Будет управлять состоянием сканирования.
    - Будет содержать `LiveData` для UI: `val statusText`, `val locatedPlayers`.
3.  **Создать `CompasActivity.kt`:**
    - `Activity` с `RecyclerView` для отображения результатов.
    - Подписывается на `LiveData` из `ViewModel`.
4.  **Создать `CompasRepository.kt`:**
    - Реализовать `suspend` функцию, которая:
        - Получает список клана (используя `OkHttp` + `Jsoup`).
        - В цикле для каждого игрока получает его `UserInfo`.
        - Если игрок онлайн, вызывает `MapPathfinder`, передавая ему текущую позицию игрока и возможные позиции цели (полученные из `MapRepository`).
        - Обновляет `LiveData` во `ViewModel` с результатом для каждого игрока.

- [ ] Портировать алгоритм поиска пути A* из `MapPath.cs` в `MapPathfinder.kt`.
- [ ] Создать `CompasActivity` и `CompasViewModel`.
- [ ] Создать `CompasRepository`, который будет оркестрировать скрейпинг, получение данных и запуск поиска пути.
- [ ] Интегрировать с `MapRepository` для получения данных о ячейках карты.
