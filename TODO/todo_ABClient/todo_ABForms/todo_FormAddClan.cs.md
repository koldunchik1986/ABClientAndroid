
### 1. План портирования FormAddClan.cs

Файл `FormAddClan.cs` реализует сложную функцию массового добавления в контакты всех членов клана указанного игрока. Логика основана на скрейпинге стороннего сайта.

### 2. Функциональность в C#

- **Назначение:** Автоматизировать добавление всех соклановцев в список контактов.
- **UI:** Использует `WebBrowser` для отображения HTML-отчета о ходе выполнения и `Label` для статуса.
- **Логика:**
    1.  Вся операция выполняется в фоновом потоке (`ThreadPool`).
    2.  Происходит скрейпинг сайта `allnl.ru` для получения списка ников всех членов клана.
    3.  HTML-ответ парсится с помощью `string.IndexOf` и `Substring`.
    4.  Для каждого найденного ника делается запрос к `NeverApi` для получения детальной информации.
    5.  UI обновляется асинхронно через `BeginInvoke`.

### 3. Решение для портирования на Android

Функциональность представляет собой классическую длительную фоновую задачу с обновлением UI. Скрейпинг — очень хрупкий подход, но его придется сохранить, улучшив инструменты.

- **UI:** Вместо `WebBrowser` следует использовать `RecyclerView` для наглядного отображения списка обработанных игроков. Общий статус показывать через `ProgressBar` и `TextView`.
- **Фоновая задача:** Использовать `ViewModel` с Kotlin Coroutines. Вся логика скрейпинга и обработки должна быть вынесена в `suspend` функцию.
- **Скрейпинг и сеть:**
    - Для сетевых запросов использовать `OkHttp`.
    - Для парсинга HTML использовать библиотеку `Jsoup`, которая гораздо надежнее ручного парсинга строк.
- **Обновление UI:** `ViewModel` должен предоставлять `LiveData` для каждого элемента UI (статус, прогресс, список игроков), на которые подписывается `Activity` или `Fragment`.

### 4. План реализации

1.  **Создать `AddClanViewModel.kt`:**
    - `ViewModel` будет управлять состоянием и координировать работу.
    - Будет содержать `LiveData` для UI: `val statusText = MutableLiveData<String>()`, `val processedPlayers = MutableLiveData<List<PlayerStatus>>()`.
2.  **Создать `AddClanActivity.kt`:**
    - `Activity` с макетом, содержащим `RecyclerView` и `ProgressBar`.
    - Подписывается на `LiveData` из `ViewModel` и обновляет `Adapter` для `RecyclerView`.
3.  **Создать `AddClanRepository.kt`:**
    - Реализовать в нем `suspend` функцию, которая будет выполнять всю работу:
        - С помощью `OkHttp` скачать HTML со страницы кланов на `allnl.ru`.
        - С помощью `Jsoup` распарсить HTML и извлечь список ников.
        - В цикле для каждого ника вызывать `NeverApi` (или его портированный аналог), получать данные.
        - После обработки каждого игрока обновлять `LiveData` во `ViewModel`.
4.  **Модель данных для UI:**
    - Создать `data class PlayerStatus(val nick: String, val level: Int, val status: String)` для отображения в `RecyclerView`.

- [ ] Создать `AddClanActivity` с `RecyclerView`.
- [ ] Создать `AddClanViewModel` для управления процессом.
- [ ] Создать `AddClanRepository` для выполнения сетевых запросов и парсинга.
- [ ] Использовать `OkHttp` для сети и `Jsoup` для парсинга HTML.
- [ ] Связать `ViewModel` и `Activity` через `LiveData`.
