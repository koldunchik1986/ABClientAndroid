# План портирования ConfigSelector.cs

Файл `ConfigSelector.cs` является статическим классом-менеджером, который управляет всем процессом выбора, создания, редактирования и загрузки профиля пользователя при старте приложения.

## Функциональность в C#

*   **`Process()`**: Основной метод, который является точкой входа при запуске приложения. Он выполняет следующую последовательность действий:
    1.  Ищет в папке приложения файлы профилей (`*.abf`).
    2.  Если их нет, запускает процедуру создания нового профиля.
    3.  Если профили есть, загружает их все в память.
    4.  Проверяет, включен ли авто-вход для последнего использованного профиля. Если да, показывает окно `FormAutoLogon` с обратным отсчетом.
    5.  Если авто-вход не сработал, показывает окно `FormProfiles` со списком всех профилей для ручного выбора.
    6.  После выбора профиля, проверяет, зашифрован ли он. Если да, показывает окно `FormAskPassword` для ввода мастер-пароля и расшифровки.
    7.  Возвращает готовый к использованию объект `UserConfig`.
*   **Вспомогательные методы**: `CreateNewConfig`, `EditExistingConfig`, `TryDecrypt` — открывают соответствующие диалоговые окна (`FormProfile`, `FormAskPassword`) для выполнения своих задач.

## План портирования на Android

Вся эта логика должна быть перенесена в класс-синглтон, который будет управлять профилями, но вместо показа `Form` он будет запускать `Activity` или `DialogFragment`.

1.  **Создать `ProfileManager.java`**: Сделать его синглтоном.

2.  **Реализовать методы**:
    *   **`loadAllProfiles(Context context)`**: Этот метод будет получать список всех `SharedPreferences` файлов приложения и для каждого создавать объект `UserConfig`, формируя `List<UserConfig>`.
    *   **`getProfile(Context context, String profileName)`**: Загружает конкретный профиль по имени.
    *   **`saveProfile(UserConfig config)`**: Сохраняет все поля из объекта `UserConfig` в соответствующий `SharedPreferences` файл.
    *   **`startProfileSelection(Activity activity)`**: Этот метод будет аналогом `Process()`. Он будет:
        1.  Вызывать `loadAllProfiles`.
        2.  Если список пуст, запускать `SettingsActivity` для создания нового профиля.
        3.  Проверять флаг авто-входа у профиля по умолчанию.
        4.  Если авто-вход включен, показывать `AutoLogonDialog`.
        5.  В противном случае, запускать `ProfilesActivity` со списком всех профилей.
    *   **`decryptProfileIfNeeded(Activity activity, UserConfig config, Callback callback)`**: Метод, который проверяет `config.isEncrypted()`. Если да, он показывает `AskPasswordDialog`. В `callback`-е диалога он вызывает `config.decrypt()` и, в случае успеха, вызывает `callback.onSuccess()`.

3.  **Стартовая `Activity`**: Главная `Activity` приложения при своем запуске (`onCreate`) должна будет вызвать `ProfileManager.getInstance().startProfileSelection(this)`. В зависимости от действий пользователя, `ProfileManager` либо запустит другую `Activity` (например, `ProfilesActivity`), либо, после успешного авто-входа/расшифровки, сообщит главной `Activity`, что можно начинать загрузку игры с выбранным профилем.