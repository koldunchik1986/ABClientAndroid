# План портирования FormProfile.cs

Файл `FormProfile.cs` реализует окно для создания и редактирования профиля пользователя, включая его аутентификационные данные, настройки прокси и шифрование.

## Функциональность в C#

*   **Редактирование данных**: Форма предоставляет поля для ввода/изменения логина, игрового пароля, флеш-пароля.
*   **Настройки прокси**: Позволяет включить использование прокси, указать его адрес, логин/пароль, а также имеет функцию для автоматического определения системных настроек прокси.
*   **Авто-вход**: `CheckBox` для включения/отключения автоматического входа в игру для данного профиля.
*   **Шифрование профиля**: Ключевая функция. Позволяет пользователю установить "мастер-пароль". После установки, игровые пароли в профиле шифруются. Защищенный профиль не может использовать функцию авто-входа. Повторный ввод мастер-пароля снимает шифрование.

## Зависимости

*   **`Config.cs`**: Класс, хранящий все данные профиля и методы `Encrypt`/`Decrypt`.
*   **`NewPassword.cs` / `AskPassword.cs`**: Диалоги для ввода мастер-пароля.
*   **`Helpers.Crypts`**: Вероятное местонахождение алгоритмов шифрования.

## План портирования на Android

Этот экран должен быть реализован как стандартный экран настроек Android с использованием `PreferenceScreen`.

1.  **Портирование логики шифрования**:
    *   **Приоритет**: Найти и аккуратно портировать на Java методы `Encrypt` и `Decrypt` из C#. Необходимо убедиться, что используется тот же алгоритм и параметры (ключ, вектор инициализации и т.д.), чтобы обеспечить совместимость со старыми файлами профилей, если это необходимо.
    *   **Безопасное хранение**: Мастер-пароль или ключ шифрования нельзя хранить в открытом виде. Для этого в Android следует использовать `AndroidX.security:security-crypto`, который предоставляет `EncryptedSharedPreferences` и `Keystore` для безопасного хранения секретов.

2.  **Создание экрана настроек (`PreferenceScreen`)**:
    *   Создать `xml/profile_preferences.xml`.
    *   **Основные данные**: Использовать `EditTextPreference` для логина и паролей. Установить `android:inputType="textPassword"` для полей с паролями.
    *   **Прокси**: Использовать `SwitchPreferenceCompat` для включения/выключения и зависимые `EditTextPreference` для адреса и данных аутентификации.
    *   **Авто-вход**: `SwitchPreferenceCompat` для авто-входа.

3.  **Реализация шифрования в UI**:
    *   Создать кастомный `Preference` (например, `PasswordProtectionPreference`).
    *   Его `summary` будет динамически обновляться ("Профиль защищен" / "Профиль не защищен").
    *   При нажатии на него:
        *   Если профиль не защищен, показать `AlertDialog` с `EditText` для ввода нового мастер-пароля. После подтверждения вызвать `config.encrypt(masterPassword)` и сохранить зашифрованный профиль.
        *   Если профиль защищен, показать `AlertDialog` для ввода текущего мастер-пароля (аналог `AskPassword`). После успешной проверки вызвать `config.decrypt(masterPassword)`.
    *   При изменении статуса шифрования, программно включать/выключать `SwitchPreferenceCompat` для авто-входа.

4.  **Реализация определения прокси**:
    *   Создать `Preference` с заголовком "Определить прокси".
    *   В обработчике `onPreferenceClick` для него реализовать логику получения системных настроек прокси в Android. Это делается через чтение системных свойств, таких как `http.proxyHost`, `http.proxyPort`.
