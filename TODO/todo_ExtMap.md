# Общий анализ папки ExtMap

Папка `ExtMap` содержит всю логику, связанную с картой игрового мира. Это ядро системы навигации, компаса и других функций, требующих знаний о географии мира.

## Содержимое папки

*   **`Map.cs`**: Центральный статический класс, который, по-видимому, загружает данные карты (вероятно, из `map.xml`) и предоставляет доступ к ним. Хранит коллекции всех клеток, позиций и т.д.
*   **`Cell.cs`, `Position.cs`**: Простые классы (POCO), описывающие сущности "клетка карты" и "позиция". Хранят координаты, `RegNum`, название локации и другие свойства.
*   **`MapPath.cs`, `MapPathNode.cs`**: Реализация алгоритма поиска кратчайшего пути. `MapPath` является фасадом, который принимает начальную и конечную точки и, используя `MapPathNode` как узлы графа, строит маршрут (вероятно, с помощью алгоритма A* или Дейкстры).
*   **`NavScriptManager.cs`**: Менеджер для выполнения сложных, заскриптованных навигационных последовательностей (например, проход через городские ворота, квестовые перемещения).
*   **`MapBot.cs`**: Логика, связанная с ботами на карте.
*   **`ListItem...cs`**: Вспомогательные классы для представления картографических данных в элементах UI (например, в списках).

## Сложность и план портирования

Это **критически важный, но сложный, чисто алгоритмический модуль**. Без него не будут работать авто-перемещение, компас и другие ключевые функции клиента. Портирование не связано с UI, но требует аккуратного переноса алгоритмов и структур данных.

**Статус: Высокий приоритет. Блокирует функциональность `FormCompas` и авто-перемещение в `MainPhp`.**

### Поэтапный план портирования

1.  **Портирование структур данных**:
    *   Создать в Java data-классы (POJO) `Cell.java`, `Position.java`, `MapPathNode.java` и другие, перенеся в них все поля из C#-аналогов.

2.  **Перенос и парсинг данных карты**:
    *   Найти файл с данными карты (предположительно `map.xml`) и поместить его в папку `app/src/main/assets/`.
    *   Написать `MapXmlParser.java` (используя `XmlPullParser`), который будет читать этот файл и заполнять коллекции объектов, созданных на шаге 1.

3.  **Портирование `Map.java`**:
    *   Создать класс `Map.java` (вероятно, синглтон).
    *   В нем разместить коллекции (`HashMap<String, Cell>`, `HashMap<String, Position>`), которые будут заполняться парсером.
    *   Перенести в него вспомогательные методы из `Map.cs`.

4.  **Портирование алгоритма `MapPath.java`**:
    *   Это **самый сложный и ответственный этап**.
    *   Необходимо аккуратно, строка за строкой, перенести логику алгоритма поиска пути из `MapPath.cs` в `MapPath.java`.
    *   Особое внимание уделить работе с коллекциями, очередями с приоритетом и логике вычисления "веса" ребер графа.
    *   Написать юнит-тесты для `MapPath.java`, чтобы убедиться, что для нескольких контрольных точек (например, от Форпоста до Октала) он строит такой же маршрут, как и C#-версия.

5.  **Портирование остальных классов**:
    *   Перенести логику `NavScriptManager`, `MapBot` и других вспомогательных классов.

После завершения портирования всей папки, можно будет разблокировать и приступать к реализации `FormCompas` и логики авто-перемещения в `MainPhp`.

## Список файлов в папке

*   AbcCell.cs
*   Cell.cs
*   GroupCell.cs
*   ListItemBotLevel.cs
*   ListItemCell.cs
*   ListItemPosition.cs
*   ListItemSearch.cs
*   Map.cs
*   MapBot.cs
*   MapPath_0101.cs
*   MapPath_0103.cs
*   MapPath.cs
*   MapPathNode.cs
*   NavScriptManager.cs
*   Position.cs
