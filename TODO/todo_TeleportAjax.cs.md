# План портирования TeleportAjax.cs

Файл `TeleportAjax.cs` (метод `TeleportAjax` внутри `MainPhp.cs`) является частью системы автоматической навигации и отвечает за использование телепортов.

## Функциональность в C#

Этот метод вызывается из `MainPhp`, когда персонаж находится на клетке с телепортом и включен режим авто-перемещения (`AutoMoving`).

1.  **Проверка и обновление маршрута**: Как и `MapAjax`, метод сначала проверяет актуальность построенного маршрута (`MapPath`) и при необходимости перестраивает его.

2.  **Поиск точки телепортации**:
    *   Из HTML-кода страницы парсится JavaScript-массив `var telep = [...]`, содержащий список доступных для телепортации пунктов назначения.
    *   Метод ищет в этом списке тот пункт, который соответствует следующему шагу в построенном маршруте (`AppVars.AutoMovingNextJump`).

3.  **Инициация телепортации**:
    *   Найдя нужный пункт, метод извлекает из него координаты и `vcode`.
    *   На основе этих данных формируется URL для совершения телепортации.
    *   Возвращается HTML-код с редиректом на этот URL, что заставляет клиент совершить переход.

4.  **Выход из здания телепорта**: Если на странице нет списка телепортов, но есть другие специфичные JS-массивы, метод определяет, что персонаж находится внутри, и генерирует редирект для выхода на карту.

## Зависимости

*   **`MainPhp.cs`**: Является частью логики `MainPhp`.
*   **`ExtMap`**: Критически зависит от `MapPath` для получения следующей точки маршрута и от `Map` для сопоставления координат и номеров регионов.

## План портирования в Android

Этот модуль должен портироваться вместе со всей системой навигации.

**Статус: БЛОКИРОВАНО.**

Портирование `TeleportAjax` должно быть частью общего плана портирования `MainPhp` (см. `TODO/todo_MainPhp.cs.md`).

**Конкретные шаги в рамках будущего портирования `MainPhp`:**

1.  **Портировать `ExtMap`**: Перенести на Java все классы, связанные с картой и навигацией.
2.  **Создать `TeleportAjaxProcessor.java`**: Вынести всю логику из C#-метода `TeleportAjax` в отдельный Java-класс.
3.  **Реализовать `process(html)`**: Метод будет принимать HTML, парсить его и, если найден нужный пункт телепортации, возвращать HTML-код с редиректом.
4.  **Интеграция**: `MainPhp.java` будет вызывать `TeleportAjaxProcessor.process()` в нужный момент (когда персонаж на клетке с телепортом).
