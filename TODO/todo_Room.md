# Отладка: Персонажи не отображаются в комнате при активном CustomWebViewClient

**Версия:** 1.0.6

## Проблема

При включенном `CustomWebViewClient` в `GameActivity` фрейм, отвечающий за отображение комнаты (`/ch.php`), не показывает список персонажей. Если `CustomWebViewClient` отключить и использовать стандартный клиент, персонажи отображаются корректно.

Данные о персонажах присутствуют в ответе от сервера, но по какой-то причине не рендерятся на странице.

## Цель

Выяснить, какая часть `CustomWebViewClient` мешает корректной отрисовке списка персонажей, и исправить это, не отключая сам `CustomWebViewClient`, так как он необходим для другого функционала (например, для работы прокси и кэширования).

## План отладки

1.  `[x]` **Проанализировать код `CustomWebViewClient`**:
    *   `[x]` Найден файл `MainActivity.java` (класс `CustomWebViewClient` является внутренним классом `MainActivity`).
    *   `[x]` Изучен метод `shouldInterceptRequest`. Обнаружены модификации `ch/ch_list.js`, извлечение `ChatListU` из `ch.php?lo=1`, применение `postfilter.Filter.process` и `injectJsFix`.
    *   `[x]` Изучен метод `onPageFinished`. Обнаружена строка `view.evaluateJavascript("javascript:(function() { var frameset = document.getElementsByTagName('frameset')[0]; if (frameset) { frameset.cols = '0, *'; } })()", null);` при `url.contains("ch.php")`.
    *   `[x]` Изучен метод `injectJsFix`. Он внедряет большой блок JavaScript для совместимости.

## Первоначальные гипотезы

*   **Гипотеза 1 (onPageFinished):** Наиболее вероятная причина - строка `frameset.cols = '0, *'` в `onPageFinished` при загрузке `ch.php`. Это может скрывать первый столбец фреймсета, где должны отображаться персонажи.

*   **Гипотеза 2 (shouldInterceptRequest - ch/ch_list.js):** Модификация `ch/ch_list.js` или некорректное определение `ChatListU` может нарушать логику отрисовки персонажей.

*   **Гипотеза 3 (shouldInterceptRequest - postfilter/injectJsFix):** Фильтры или внедренный JavaScript могут удалять/скрывать данные персонажей или конфликтовать с их отрисовкой.

## Следующие шаги

1.  `[ ]` **Проверить Гипотезу 1:** Временно закомментировать или изменить строку `frameset.cols = '0, *'` в `onPageFinished` для URL, содержащих `ch.php`, и проверить, решается ли проблема.

2.  `[ ]` **Проанализировать трафик и контент**:
    *   `[ ]` Перехватить и сравнить HTML/JS контент, который загружается во фрейм с включенным и отключенным `CustomWebViewClient`.
    *   `[ ]` Обратить особое внимание на URL `ch.php` и связанные с ним ресурсы (JS, CSS).
