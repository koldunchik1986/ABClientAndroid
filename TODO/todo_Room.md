# Отладка: Персонажи не отображаются в комнате при активном CustomWebViewClient

**Версия:** 1.0.6

## Проблема

При включенном `CustomWebViewClient` в `GameActivity` фрейм, отвечающий за отображение комнаты (`/ch.php`), не показывает список персонажей. Если `CustomWebViewClient` отключить и использовать стандартный клиент, персонажи отображаются корректно.

Данные о персонажах присутствуют в ответе от сервера, но по какой-то причине не рендерятся на странице.

## Цель

Выяснить, какая часть `CustomWebViewClient` мешает корректной отрисовке списка персонажей, и исправить это, не отключая сам `CustomWebViewClient`, так как он необходим для другого функционала (например, для работы прокси и кэширования).

## Анализ и решение

1.  `[x]` **Проанализирован код `CustomWebViewClient`**:
    *   `[x]` Изучен метод `shouldInterceptRequest`. Обнаружено, что он извлекает массив `ChatListU` из ответа `ch.php?lo=1`, сохраняет его в `AppVars.chatListU`, а затем внедряет этот массив в скрипт `ch_list.js`.
    *   `[x]` Изучены логи, которые показали, что извлеченный `ChatListU` был поврежден из-за проблем с кодировкой (`Russian.getString`).

2.  `[x]` **Выдвинута и проверена гипотеза:**
    *   **Гипотеза:** Проблема заключается в избыточном и некорректном процессе: извлечение `ChatListU` -> сохранение в `AppVars` -> внедрение в `ch_list.js`. Оригинальная страница `ch.php?lo=1` уже содержит корректно определенный `ChatListU` на месте, и скрипт `ch_list.js` должен использовать именно его.
    *   **Решение:** В `MainActivity.java`, в методе `shouldInterceptRequest`, закомментирован блок кода, который внедрял `AppVars.chatListU` в `ch_list.js`.

## Статус

*   `[x]` **Гипотеза 1 (onPageFinished):** Проверена и отклонена.
*   `[x]` **Гипотеза 2 (shouldInterceptRequest - ch/ch_list.js):** Проверена и подтверждена. Проблема в избыточной модификации `ch_list.js`.
*   `[x]` **Решение:** Внедрение `ChatListU` в `ch_list.js` отключено.

## Следующие шаги

*   `[ ]` **Тестирование:** Необходимо проверить, что после последнего изменения персонажи в комнате отображаются корректно.