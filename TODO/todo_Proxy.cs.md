# План портирования Proxy.cs

Файл `Proxy.cs` является главным классом, "точкой входа" для всего кастомного прокси-сервера.

## Функциональность в C#

1.  **Запуск сервера (`Start`)**: 
    *   Создает `Socket` и начинает прослушивать локальный TCP-порт (например, 8052).
    *   Асинхронно принимает входящие TCP-соединения от клиентов.
    *   Для каждого нового соединения создает объект `Session`, который будет обрабатывать полный цикл HTTP-транзакции.
2.  **Системная интеграция (`SetProxy`)**:
    *   С помощью вызова WinAPI-функции `InternetSetOption` **программно устанавливает себя в качестве системного прокси-сервера**. 
    *   Именно этот шаг заставляет компонент `WebBrowser` (который использует системные настройки WinINET) автоматически направлять все свои HTTP-запросы на наш локальный прокси-сервер.
3.  **Поддержка внешнего прокси**:
    *   Если пользователь указал в настройках внешний прокси, `Proxy.cs` готовит данные для аутентификации на нем, чтобы иметь возможность пересылать запросы дальше.

## Решение для портирования на Android

**Портировать этот класс не нужно.**

Этот класс решает задачу "как заставить браузер отправлять запросы нам". В Android эта задача решается совершенно иначе и намного проще.

Вместо запуска локального сервера и изменения системных настроек, мы просто предоставляем нашему `WebView` кастомный `WebViewClient`.

```java
MyWebViewClient myWebViewClient = new MyWebViewClient();
myWebView.setWebViewClient(myWebViewClient);
```

После этого `WebView` для каждого запроса будет вызывать метод `shouldInterceptRequest` в нашем `myWebViewClient`. Это дает нам полный контроль над сетевым трафиком `WebView` без необходимости работать с сокетами, портами и системными настройками.

Таким образом, вся сложная логика `Proxy.cs` заменяется одной строчкой `myWebView.setWebViewClient(...)` и реализацией класса-наследника `WebViewClient`.
