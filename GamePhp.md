# Портирование `GamePhp.cs` в `GamePhp.java`

## Анализ `GamePhp.cs` (ПК версия)

Файл `GamePhp.cs` в оригинальном C# клиенте отвечает за обработку HTML-содержимого, загружаемого из `game.php`. Основная функция этого фильтра — управление процессом ввода Flash-пароля, если он требуется.

Ключевые действия, выполняемые `GamePhp.cs`:

1.  **Удаление DOCTYPE:** Использует вспомогательный метод `RemoveDoctype` для удаления декларации `DOCTYPE` из HTML.
2.  **Обработка Flash-пароля:**
    *   Проверяет флаг `AppVars.WaitFlash` и наличие сохраненного Flash-пароля (`AppVars.Profile.UserPasswordFlash`).
    *   Если условия соблюдены, ищет в HTML идентификатор Flash-приложения (`plid=...`).
    *   При нахождении `plid` генерирует новый HTML-код, который содержит скрытую форму с Flash-паролем и JavaScript для автоматической отправки этой формы. Это позволяет клиенту автоматически вводить пароль для Flash-приложений, минуя ручной ввод.
    *   Сгенерированный HTML сохраняется в `AppVars.ContentMainPhp` и возвращается в качестве ответа.
3.  **Сохранение HTML:** Если Flash-папароль не требуется или не найден, оригинальный HTML сохраняется в `AppVars.ContentMainPhp`, а флаг `AppVars.WaitFlash` сбрасывается.

## Портирование в `GamePhp.java` (Android версия)

Логика из `GamePhp.cs` была перенесена в статический метод `process` класса `GamePhp.java` в пакете `ru.neverlands.abclient.postfilter`.

### Особенности реализации в Java:

*   **Кодировка:** Для преобразования массива байт в строку и обратно используется `Russian.Codepage.getString()` и `Russian.Codepage.getBytes()`, обеспечивая корректную работу с кодировкой `windows-1251`.
*   **Удаление DOCTYPE:** Используется существующий метод `Filter.removeDoctype(String html)` из `Filter.java`.
*   **Глобальные переменные:** Для `WaitFlash` и `ContentMainPhp` были добавлены соответствующие статические поля в `AppVars.java`. Для `UserPasswordFlash` добавлено поле в `UserConfig.java`.
*   **Генерация HTML:** Логика построения HTML-формы и JavaScript для автоотправки была перенесена с использованием `StringBuilder`. Вспомогательный метод `generateHtmlHead()` был создан для генерации базового HTML-заголовка, аналогично `HelperErrors.Head()` в C# версии.
*   **Поиск `plid`:** Поиск `flashid` выполняется без учета регистра (`toLowerCase().indexOf()`).

### Интеграция с `Filter.java`:

Метод `processGamePhp` в `ru.neverlands.abclient.postfilter.Filter.java` был изменен для вызова `GamePhp.process(array)`, что позволяет централизованному фильтру делегировать обработку `game.php` специализированному классу.

## Вывод

Портирование `GamePhp.cs` в `GamePhp.java` обеспечивает функциональность автоматического ввода Flash-пароля в Android-приложении, что является важным аспектом взаимодействия с игровым контентом, использующим Flash.
