# Анализ ShopAjaxPhp.cs

Файл `ShopAjaxPhp.cs` является частью `PostFilter` и обрабатывает AJAX-ответ от государственного магазина при просмотре вещей в инвентаре для продажи. Его главная задача — сгруппировать (собрать в стопки) одинаковые предметы для удобной массовой продажи.

## Зависимости

Этот модуль критически зависит от класса `ShopEntry.cs`, который отвечает за парсинг, сравнение и отрисовку HTML-кода для одного предмета в списке.

## Функциональность

1.  **Парсинг списка**: Фильтр итерирует по HTML-ответу, находя каждую вещь (`<tr>...</tr>`). Для каждого найденного HTML-фрагмента создается объект `ShopEntry`, который извлекает из него всю необходимую информацию (название, цена, долговечность, JS-вызов для продажи).

2.  **Группировка (стакинг)**: После парсинга всех вещей, фильтр запускает двойной цикл для сравнения всех элементов в списке друг с другом. Сравнение происходит с помощью метода `ShopEntry.CompareTo`, который считает вещи одинаковыми, если у них совпадают название и цена. При нахождении дубликата, счетчик у первого элемента увеличивается (`Inc()`), а дубликат удаляется из списка.

3.  **Восстановление состояния массовой продажи**: Часть логики отвечает за поиск JS-кода для продажи вещи, которую пользователь продавал в прошлый раз. Это необходимо для корректной работы функции "Продать все".

4.  **Пересборка HTML**: После завершения группировки, оригинальный список вещей в HTML заменяется на новый, сгенерированный на основе обработанного списка `ShopEntry`. Каждый `ShopEntry` с количеством > 1 будет отрисован с помощью своего метода `ToString()`, который добавляет счетчик `(X шт.)` и кнопку "Продать все".

## План портирования в Java

1.  **Портировать `ShopEntry.cs`**: Создать `ShopEntry.java` с реализацией `Comparable<ShopEntry>`. (Уже сделано).
2.  **Создать `ShopAjaxPhp.java`**: В пакете `ru.neverlands.abclient.postfilter`.
3.  **Реализовать метод `process`**:
    *   Реализовать цикл для парсинга HTML и создания `ArrayList<ShopEntry>`.
    *   Реализовать алгоритм группировки. Вместо удаления элементов из списка во время итерации (что может быть проблематично), можно использовать более безопасный подход: создать новый `ArrayList` для сгруппированных результатов или использовать `ListIterator.remove()`.
    *   Реализовать логику пересборки HTML с использованием `StringBuilder`.
4.  **Интегрировать в `Filter.java`**: В `Filter.java` найти условие `address.startsWith("http://www.neverlands.ru/gameplay/ajax/shop_ajax.php")` и вызывать из него `ShopAjaxPhp.process(array)`.
