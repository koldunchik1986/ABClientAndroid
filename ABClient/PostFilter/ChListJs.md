# Анализ ChListJs.cs

Файл `ChListJs.cs` является частью `PostFilter` и предназначен для **полной замены** ответа сервера на запрос `/ch/ch_list.js`.

## Логика работы

1.  **Загрузка ресурса**: Фильтр получает доступ к внутреннему ресурсу C# проекта — `Resources.ch_list`. Этот ресурс представляет собой полноценный JavaScript-файл.
2.  **Модификация**: В содержимом этого файла производится одна замена: все вхождения строки `alt=` заменяются на `title=`.
3.  **Отправка клиенту**: Модифицированный JS-код отправляется клиенту вместо оригинального файла с сервера.

**Назначение:**

*   **Кастомизация**: Позволяет использовать собственную, кастомную версию скрипта `ch_list.js` вместо той, что предоставляет сервер. Это открывает простор для глубокой модификации поведения списка контактов в чате.
*   **Интеграция с `window.external`**: Оригинальный файл `ch_list.js` (который мы скопировали в `assets`) активно использует `window.external` для взаимодействия с C#-приложением (например, `window.external.GetClassIdOfContact(login)`). Это позволяет отображать контакты по-разному в зависимости от их статуса (друг, враг и т.д.).
*   **Исправление атрибутов**: Замена `alt` на `title` — это, вероятно, исправление для улучшения кросс-браузерной совместимости и корректного отображения всплывающих подсказок в веб-компоненте C#-приложения.

## План портирования в Java

1.  **Скопировать `ch_list.js`**: Оригинальный файл `ch_list.js` из C# проекта необходимо поместить в `app/src/main/assets/js/`.
2.  **Создать `ChListJs.java`**: В пакете `ru.neverlands.abclient.postfilter`.
3.  **Реализовать метод `process`**:
    *   Метод не будет принимать аргументов, так как он не модифицирует, а генерирует контент.
    *   Он должен будет прочитать файл `js/ch_list.js` из `AssetManager`.
    *   В прочитанном содержимом выполнить замену `alt=` на `title=`.
    *   Заменить вызовы `window.external` на `AndroidBridge` для совместимости с Android.
    *   Вернуть результат в виде `byte[]`.
4.  **Интегрировать в `Filter.java`**:
    *   В `Filter.java` найти условие `address.endsWith("/ch/ch_list.js")`.
    *   Вызывать из него `ChListJs.process()`.
