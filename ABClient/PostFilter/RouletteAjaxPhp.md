# Анализ RouletteAjaxPhp.cs

Файл `RouletteAjaxPhp.cs` является частью `PostFilter` и обрабатывает AJAX-ответ от сервера после вращения рулетки (`gameplay/ajax/roulette_ajax.php`).

## Функциональность

Задача этого фильтра — обработать результат вращения и обновить интерфейс игры.

1.  **Парсинг ответа**: Сервер возвращает результат в специальном формате, где данные разделены символом `@`. Например:
    `OK@Поздравляем, Вы выиграли 50 NV.@1@3@4@2.4@1@14785.5@1600.34@1`
    Фильтр разбивает эту строку на массив.

2.  **Отображение результата в чате**: Если первая часть ответа (`args[0]`) равна `"OK"`, фильтр берет вторую часть (`args[1]`), которая содержит текстовое описание выигрыша, и отправляет его в игровой чат с помощью `AppVars.MainForm.BeginInvoke`.

3.  **Обновление игрового фрейма**: Сразу после этого, фильтр инициирует перезагрузку основного игрового фрейма, загружая в него URL страницы рулетки (`http://www.neverlands.ru/main.php?mselect=15`). Это необходимо, чтобы пользователь увидел актуальное состояние рулетки (например, обновленный джекпот или количество доступных вращений).

## План портирования в Java

1.  **Создать `RouletteAjaxPhp.java`** в пакете `ru.neverlands.abclient.postfilter`.
2.  **Реализовать метод `process`**:
    *   Конвертировать `byte[]` в строку.
    *   Разбить строку по символу `@` с помощью `String.split("@")`.
    *   Проверить, что первая часть — `"OK"`.
    *   Для отображения сообщения в чате использовать `Handler` или `LocalBroadcastManager` для отправки события в UI-поток.
    *   Для обновления фрейма также использовать механизм отправки событий, который будет перехвачен `Activity`/`Fragment` и вызовет `webView.loadUrl("http://www.neverlands.ru/main.php?mselect=15")`.
3.  **Интегрировать в `Filter.java`**: В `Filter.java` найти условие `address.startsWith("http://www.neverlands.ru/gameplay/ajax/roulette_ajax.php")` и вызывать из него `RouletteAjaxPhp.process(array)`.
