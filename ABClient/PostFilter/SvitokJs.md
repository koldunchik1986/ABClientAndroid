# Анализ SvitokJs.cs

Файл `SvitokJs.cs` является частью `PostFilter` и предназначен для модификации JavaScript-файла `/js/svitok.js`.

## Основные модификации

Этот фильтр находит большой блок HTML-кода, генерируемый внутри JavaScript, и добавляет к кнопке отправки формы обработчик `onclick`.

*   **Контекст**: Модифицируется форма, которая появляется при использовании свитка на другого персонажа.
*   **Модификация**: В тег `<input type=submit>` добавляется атрибут `onclick`.
    *   **Добавляемый код:** `onclick="window.external.TraceDrinkPotion(fornickname.value, \'' + wnametxt + '')"`

**Назначение:**

Основная цель — перехватить событие использования свитка на другого игрока. Когда пользователь нажимает кнопку "выполнить", перед отправкой формы вызывается метод `TraceDrinkPotion` в хост-приложении (C#). В этот метод передаются два параметра:

1.  `fornickname.value`: Ник цели, на которую используется свиток.
2.  `wnametxt`: Название используемого свитка.

Это позволяет приложению вести лог использования предметов, отслеживать действия игрока или реализовывать другую связанную с этим логику.

## План портирования в Java

1.  **Создать `SvitokJs.java`** в пакете `ru.neverlands.abclient.postfilter`.
2.  **Реализовать метод `process`**:
    *   Метод будет принимать `byte[]`.
    *   Конвертировать их в строку (`windows-1251`).
    *   Выполнить замену, добавив `onclick` к кнопке. Вместо `window.external` будет использоваться `AndroidBridge`.
    *   Конвертировать измененную строку обратно в `byte[]`.
3.  **Интегрировать в `Filter.java`**:
    *   В `Filter.java` найти условие `address.endsWith("/js/svitok.js")`.
    *   Вызывать из него `SvitokJs.process(array)`.
