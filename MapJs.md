# Портирование `MapJs.cs` в `MapJs.java`

## Анализ `MapJs.cs` (ПК версия)

Файл `MapJs.cs` в оригинальном C# клиенте отвечает за обработку JavaScript-содержимого, загружаемого из `/js/map.js`.

**Ключевая особенность:** Метод `MapJs(byte[] array)` в C# версии **полностью игнорирует входной массив байт** (`array`) и вместо этого возвращает содержимое статического ресурса `Resources.map`. Это означает, что `map.js` не модифицируется динамически, а заменяется предопределенным содержимым.

Закомментированный код в `MapJs.cs` указывает на то, что ранее здесь могли выполняться замены, связанные с размерами карты и вызовами `window.external`, но в текущей версии они неактивны.

## Портирование в `MapJs.java` (Android версия)

Логика из `MapJs.cs` была перенесена в статический метод `process` класса `MapJs.java` в пакете `ru.neverlands.abclient.postfilter`.

### Особенности реализации в Java:

*   **Игнорирование входных данных:** В соответствии с поведением оригинальной C# версии, метод `process` в `MapJs.java` также игнорирует входной массив байт.
*   **Чтение из Assets:** Вместо использования `Resources.map` (который является специфичным для C# ресурсов), `MapJs.java` читает содержимое файла `map.js` из папки `assets` Android-приложения. Это соответствует концепции статического ресурса.
*   **Получение контекста:** Для доступа к `AssetManager` используется `ABClientApplication.getAppContext()`.
*   **Обработка ошибок:** Предусмотрена обработка `IOException` при чтении файла из assets, возвращая пустой массив байт в случае ошибки.

### Интеграция с `Filter.java`:

Метод `processMapJs` в `ru.neverlands.abclient.postfilter.Filter.java` был изменен для вызова `MapJs.process(array)`, что позволяет централизованному фильтру делегировать обработку `/js/map.js` специализированному классу.

## Вывод

Портирование `MapJs.cs` в `MapJs.java` обеспечивает корректную загрузку и предоставление статического JavaScript-файла карты, как это реализовано в оригинальном C# клиенте. Это гарантирует, что `WebView` получит ожидаемый код карты, несмотря на то, что он не модифицируется динамически.
