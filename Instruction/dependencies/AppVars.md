# Инструкция: Глобальные переменные (AppVars)

## 1. Назначение

Класс `AppVars` — это аналог одноименного класса из оригинального C# проекта. Он представляет собой статический контейнер для хранения глобальных переменных, состояния приложения и общих данных, которые должны быть доступны из любой точки программы.

Использование такого класса позволяет разным компонентам (активностям, сервисам, фоновым задачам) обмениваться информацией без необходимости передавать ее через `Intent` или сложные конструкторы. Это упрощает архитектуру, но требует осторожного обращения с данными, чтобы избежать состояний гонки или утечек памяти.

## 2. Инициализация

**Метод:** `public static void init(Context context)`
-   **Действие:** Этот метод вызывается один раз при старте приложения в `ABClientApplication.onCreate()`.
-   **Задачи:**
    1.  Сохраняет ссылку на `AssetManager` для доступа к ресурсам приложения.
    2.  Определяет и при необходимости создает папку `Logs` для хранения лог-файлов.

## 3. Ключевые поля

Класс содержит большое количество `public static` полей. Ниже перечислены наиболее важные группы и примеры.

#### Состояние пользователя и профиля
-   **`public static UserConfig Profile;`**: Самое важное поле. Хранит полную конфигурацию текущего пользователя, включая его ник, настройки автоматизации, списки контактов и т.д.
-   **`public static List<HttpCookie> lastCookies;`**: Хранит `Cookie` последней успешной сессии авторизации. Используется для их внедрения в `WebView`.
-   **`public static Date ServerDateTime;`**: Хранит последнее известное время сервера.

#### Данные, извлеченные из страниц
-   **`public static byte[] lastMainPhpResponse;`**: "Сырой" ответ страницы `main.php`.
-   **`public static byte[] lastChatMsgResponse;`**: "Сырой" ответ страницы `msg.php` (сообщения чата).
-   **`public static String chatListU;`**: Строка, содержащая JavaScript-массив пользователей в текущей локации, извлеченная из `ch.php?lo=1`.
-   **`public static List<ru.neverlands.abclient.model.InvEntry> InvList;`**: Распарсенный список предметов в инвентаре.

#### Настройки и флаги состояния
-   **`public static boolean AutoMoving = false;`**: Флаг, указывающий, активен ли в данный момент авто-переход по карте.
-   **`public static boolean DoShowWalkers = true;`**: Флаг, определяющий, нужно ли отображать на карте "ходунков".
-   **`public static int LocalProxyPort = 8052;`**: Порт, на котором запускается локальный прокси-сервер.

#### Ссылки на компоненты
-   **`public static WeakReference<MainActivity> mainActivity;`**: Слабая ссылка на главный экран приложения. Использование `WeakReference` помогает избежать утечек памяти, позволяя сборщику мусора уничтожить `MainActivity`, если на нее не осталось других "сильных" ссылок.

## 4. Принципы работы

-   **Доступ:** Любой класс в приложении может напрямую читать и изменять поля `AppVars` (например, `AppVars.AutoMoving = true;`).
-   **Потокобезопасность:** Данный класс **не является потокобезопасным**. При доступе к его полям из разных потоков (например, из фоновой задачи и UI-потока) необходимо самостоятельно обеспечивать синхронизацию, используя `runOnUiThread`, `synchronized` блоки или другие механизмы.
