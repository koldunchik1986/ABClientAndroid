# Инструкция по работе кнопок навигации

## Общее описание

Кнопки навигации в игре (например, "Инвентарь", "Выйти") реализованы с помощью JavaScript функции `ButClick(id)`, которая вызывается при нажатии на соответствующую кнопку. Эта функция формирует URL для перехода и осуществляет переход в фрейме `main`.

## Ключевые файлы и переменные

*   **`castle_v05.js`**: Основной файл, содержащий логику работы кнопок.
*   **`HtmlLog_Main_*.txt`**: Снимок HTML-кода основного фрейма, в котором инициализируются переменные для работы кнопок.
*   **`ChListJs.java`**: Java-класс, который модифицирует `ch_list.js`.
*   **`CastleJs.java`**: Java-класс, который модифицирует `castle_v05.js`.

### Переменные в HTML

В HTML-коде основного фрейма инициализируются следующие ключевые переменные:

*   `mapbt`: Массив, содержащий информацию о кнопках. Каждый элемент массива представляет собой кнопку и содержит:
    *   `id`: Идентификатор кнопки (например, `inf`, `inv`, `up`).
    *   `Название`: Текст кнопки.
    *   `vcode`: Уникальный код для формирования URL.
    *   `[]`: Пустой массив (не используется).

    **Пример:**
    ```javascript
    var mapbt = [["inf","Ваш персонаж","99e727b76fb80ecc8bd9b2fdd72916ea",[]],["inv","Инвентарь","5b5ae3b970c4da3dd2afe4ee4cc4ec74",[]],["up","Выйти","e33b8852aff8c729a6c22c10ee8bab18",[]]];
    ```

*   `bavail`: Ассоциативный массив, который формируется из `mapbt` в функции `ButtonGen()` и используется в `ButClick(id)` для получения `vcode`.

### Функция `ButClick(id)`

Эта функция вызывается при нажатии на кнопку. Она выполняет следующие действия:

1.  Принимает `id` кнопки в качестве аргумента.
2.  Формирует URL для перехода, используя `id` и `vcode` из массива `bavail`.
3.  Осуществляет переход по сформированному URL в фрейме `main` с помощью `window.open(goloc, 'main')`.

**Пример:**
```javascript
function ButClick(id)
{
    var goloc = '';
    switch(id)
    {
        case 'inf': goloc = 'main.php?get_id=56&act=10&go=inf&vcode='+bavail[id][0]; break;
        case 'inv': goloc = 'main.php?get_id=56&act=10&go=inv&vcode='+bavail[id][0]; break;
        case 'up': goloc = 'main.php?get_id=56&act=10&go=up&vcode='+bavail[id][0]; break;
    }
    if(goloc)
    {
        for(var j=0; j<bavail[id][1].length; j++) goloc += '&'+bavail[id][1][j][0]+'='+bavail[id][1][j][1];
        window.open(goloc, 'main');
    }
}
```

## Процесс работы

1.  При загрузке основного фрейма инициализируются переменные `mapbt` и `bavail`.
2.  При нажатии на кнопку вызывается функция `ButClick(id)`.
3.  `ButClick(id)` формирует URL и открывает его в фрейме `main`.

## Патчи

Для корректной работы кнопок в Android-приложении были применены следующие патчи:

*   **`ChListJs.java`**: Исправлена синтаксическая ошибка в формировании HTML-кода.
*   **`CastleJs.java`**: `document.location = goloc;` заменен на `window.open(goloc, 'main');` для предотвращения перезагрузки всей страницы.
