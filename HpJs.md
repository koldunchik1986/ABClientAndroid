# Портирование `HpJs.cs` в `HpJs.java`

## Анализ `HpJs.cs` (ПК версия)

Файл `HpJs.cs` в оригинальном C# клиенте отвечает за обработку JavaScript-содержимого, загружаемого из `/js/hp.js`. Основная задача этого фильтра — модифицировать JavaScript-код, который отвечает за отображение текущего и максимального уровня здоровья (HP) и маны (MA).

Ключевое изменение, выполняемое `HpJs.cs`:

1.  **Перенаправление отображения HP/MA:** Заменяет сложную JavaScript-строку, которая форматирует и выводит информацию о HP/MA, на вызов метода `window.external.ShowHpMaTimers(...)`. Это позволяет нативному Android-коду (через `JavascriptInterface`) перехватывать данные о HP/MA и отображать их в пользовательском интерфейсе Android-приложения, а не полагаться на стандартное отображение в `WebView`.

## Портирование в `HpJs.java` (Android версия)

Логика из `HpJs.cs` была перенесена в статический метод `process` класса `HpJs.java` в пакете `ru.neverlands.abclient.postfilter`.

### Особенности реализации в Java:

*   **Кодировка:** Для преобразования массива байт в строку и обратно используется `Russian.Codepage.getString()` и `Russian.Codepage.getBytes()`, обеспечивая корректную работу с кодировкой `windows-1251`.
*   **Замена строки:** Операция `html.Replace()` из C# была напрямую перенесена в Java с использованием метода `String.replace()`.
*   **`window.external`:** Инъекция `window.external.ShowHpMaTimers()` сохранена. Для полноценной работы этой функциональности необходимо убедиться, что в `WebView` Android-приложения настроен `JavascriptInterface`, который предоставляет соответствующий метод `ShowHpMaTimers` для вызова из JavaScript.

### Интеграция с `Filter.java`:

Метод `processHpJs` в `ru.neverlands.abclient.postfilter.Filter.java` был изменен для вызова `HpJs.process(array)`, что позволяет централизованному фильтру делегировать обработку `hp.js` специализированному классу.

## Вывод

Портирование `HpJs.cs` в `HpJs.java` обеспечивает перехват и кастомизацию отображения информации о HP/MA в Android-приложении, что является важным шагом для создания более интегрированного и нативного пользовательского опыта.
