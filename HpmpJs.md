# Портирование `HpmpJs.cs` в `HpmpJs.java`

## Анализ `HpmpJs.cs` (ПК версия)

Файл `HpmpJs.cs` в оригинальном C# клиенте отвечает за генерацию JavaScript-кода, который управляет отображением и обновлением полос здоровья (HP) и маны (MA), а также связанных с ними таймеров.

**Ключевая особенность:** Метод `HpmpJs()` в C# версии **полностью игнорирует входные данные** и вместо этого динамически конструирует и возвращает JavaScript-строку. Этот JavaScript-код включает в себя:

*   **`ins_HP()`:** Функция для инициализации интервала обновления HP/MA.
*   **`hms(secs)`:** Вспомогательная функция для форматирования секунд в формат `HH:MM:SS` или `MM:SS`.
*   **`cha_HP()`:** Основная функция, которая вызывается по интервалу. Она обновляет ширину HTML-элементов, представляющих полосы HP/MA (`fHP`, `eHP`, `fMP`, `eMP`), и отображает текстовые значения HP/MA, включая таймеры восстановления, если они активны.

## Портирование в `HpmpJs.java` (Android версия)

Логика из `HpmpJs.cs` была перенесена в статический метод `process` класса `HpmpJs.java` в пакете `ru.neverlands.abclient.postfilter`.

### Особенности реализации в Java:

*   **Игнорирование входных данных:** В соответствии с поведением оригинальной C# версии, метод `process` в `HpmpJs.java` не принимает входной массив байт.
*   **Генерация JavaScript-строки:** Используется `StringBuilder` для точного воссоздания JavaScript-кода, определенного в C# версии. Особое внимание уделено правильному экранированию кавычек и специальных символов.
*   **Кодировка:** Для преобразования сгенерированной строки в массив байт используется `Russian.Codepage.getBytes()`, обеспечивая корректную работу с кодировкой `windows-1251`.

### Интеграция с `Filter.java`:

Метод `processHpmpJs` в `ru.neverlands.abclient.postfilter.Filter.java` был изменен для вызова `HpmpJs.process()`, что позволяет централизованному фильтру делегировать генерацию JavaScript-кода для HP/MA специализированному классу.

## Вывод

Портирование `HpmpJs.cs` в `HpmpJs.java` обеспечивает корректную динамическую генерацию JavaScript-кода для управления отображением HP/MA в Android-приложении, что является ключевым элементом пользовательского интерфейса игры.